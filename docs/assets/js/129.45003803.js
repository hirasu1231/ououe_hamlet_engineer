(window.webpackJsonp=window.webpackJsonp||[]).push([[129],{512:function(t,a,s){"use strict";s.r(a);var n=s(2),r=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("pytorch-grad-camでCAM(Class Activation Mapping)を実施します．"),s("br"),t._v("\nコードはGoogle Colabで実行していますが，最後にDockerFileも準備しています．"),s("br")]),t._v(" "),s("ClientOnly",[s("CallInArticleAdsense")],1),t._v(" "),s("p"),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#google-colabのファイル構成"}},[t._v("Google Colabのファイル構成")])]),s("li",[s("a",{attrs:{href:"#google-driveと連携"}},[t._v("Google Driveと連携")])]),s("li",[s("a",{attrs:{href:"#モジュールのインストール"}},[t._v("モジュールのインストール")])]),s("li",[s("a",{attrs:{href:"#サンプルの実行"}},[t._v("サンプルの実行")])]),s("li",[s("a",{attrs:{href:"#dockerfile"}},[t._v("DockerFile")]),s("ul",[s("li",[s("a",{attrs:{href:"#dockerfile"}},[t._v("DockerFile")])]),s("li",[s("a",{attrs:{href:"#docker-compose-yml"}},[t._v("docker-compose.yml")])]),s("li",[s("a",{attrs:{href:"#実行コード"}},[t._v("実行コード")])])])]),s("li",[s("a",{attrs:{href:"#まとめ"}},[t._v("まとめ")])]),s("li",[s("a",{attrs:{href:"#参考サイト"}},[t._v("参考サイト")])])])]),s("p"),t._v(" "),s("p",[t._v("今回はGoogle ColabとGoogle Driveを連携させて，notebook形式で実行してます．"),s("br")]),t._v(" "),s("blockquote",[s("p",[t._v("Google Colaboratory（以下Google Colab）は、Google社が無料で提供している機械学習の教育や研究用の開発環境です。開発環境はJupyter Notebookに似たインターフェースを持ち、Pythonの主要なライブラリがプリインストールされています。"),s("br"),t._v("\n引用元："),s("a",{attrs:{href:"https://interface.cqpub.co.jp/ail01/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Google Colabの使い方"),s("OutboundLink")],1)])]),t._v(" "),s("h2",{attrs:{id:"google-colabのファイル構成"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#google-colabのファイル構成"}},[t._v("#")]),t._v(" Google Colabのファイル構成")]),t._v(" "),s("p",[t._v("プロジェクトディレクトリはpytorch_CAMとしています．度々，省略しています．")]),t._v(" "),s("div",{staticClass:"language-init extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("pytorch_CAM\n├── /pytorch-grad-cam\n│   ├── /examples\n│   │   └── both.png <- テスト画像\n│   └── (省略)\n└── pytorch_CAM.ipynb <- 実行用ノートブック\n")])])]),s("h2",{attrs:{id:"google-driveと連携"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#google-driveと連携"}},[t._v("#")]),t._v(" Google Driveと連携")]),t._v(" "),s("p",[t._v("Google ColabとGoogle Driveを連携させて，gitから"),s("a",{attrs:{href:"https://github.com/jacobgil/pytorch-grad-cam.git",target:"_blank",rel:"noopener noreferrer"}},[t._v("jacobgil/pytorch-grad-cam"),s("OutboundLink")],1),t._v("をダウンロードします．")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Google ColabとGoogle Driveを連携")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" google"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("colab "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" drive\ndrive"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mount"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/content/drive'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("%%bash\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ディレクトリの移動")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /content/drive/My"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v(" Drive/pytorch_CAM\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# gitのダウンロード")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://github.com/jacobgil/pytorch-grad-cam.git\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v("\n")])])]),s("h2",{attrs:{id:"モジュールのインストール"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#モジュールのインストール"}},[t._v("#")]),t._v(" モジュールのインストール")]),t._v(" "),s("p",[t._v("ここでは，モジュールのインストールを実施します．")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("!pip install "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("upgrade pip\n!pip install dataclasses"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.6")]),t._v("\n!pip install dicom"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("factory"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".3")]),t._v("\n!pip install numpy"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.19")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".5")]),t._v("\n!pip install Pillow"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8.1")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),t._v("\n!pip install torch"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.7")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),t._v("\n!pip install torchvision"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.8")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".2")]),t._v("\n!pip install typing"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("extensions"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.7")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".4")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".3")]),t._v("\n!pip install ttach\n!pip install tqdm\n!pip install opencv"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("python\n!pip install ipywidgets\n!pip install matplotlib\n!pip install grad"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("cam\n")])])]),s("h2",{attrs:{id:"サンプルの実行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#サンプルの実行"}},[t._v("#")]),t._v(" サンプルの実行")]),t._v(" "),s("p",[t._v("CAMが起動できるかを確認するために，下記のサンプルコードで実行します．")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("cd "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("content"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("drive"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("My\\ Drive"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("pytorch_CAM"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("pytorch"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("grad"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("cam\n!ls examples"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n")])])]),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" pytorch_grad_cam "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" GradCAM"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ScoreCAM"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" GradCAMPlusPlus"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" AblationCAM"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" XGradCAM"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" EigenCAM\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" pytorch_grad_cam"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("utils"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("image "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" show_cam_on_image\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" torchvision"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("models "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" resnet50\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" pytorch_grad_cam"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("utils"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("image "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" show_cam_on_image"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" deprocess_image"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" preprocess_image\n\nmodel "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" resnet50"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pretrained"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntarget_layer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("layer4"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# データ入力")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" cv2\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" numpy "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" np\nrgb_img "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cv2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("imread"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'examples/both.png'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nrgb_img "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" np"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("float32"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rgb_img"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("255")]),t._v("\ninput_tensor "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" preprocess_image"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rgb_img"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mean"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.485")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.456")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.406")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n                                             std"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.229")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.224")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.225")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Note: input_tensor can be a batch tensor with several images!")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Construct the CAM object once, and then re-use it on many images:")]),t._v("\ncam "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" GradCAM"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("model"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" target_layer"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("target_layer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" use_cuda"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# If target_category is None, the highest scoring category")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# will be used for every image in the batch.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# target_category can also be an integer, or a list of different integers")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# for every image in the batch.")]),t._v("\ntarget_category "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# You can also pass aug_smooth=True and eigen_smooth=True, to apply smoothing.")]),t._v("\ngrayscale_cam "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cam"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("input_tensor"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("input_tensor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" target_category"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("target_category"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# In this example grayscale_cam has only one image in the batch:")]),t._v("\ngrayscale_cam "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" grayscale_cam"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nvisualization "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" show_cam_on_image"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rgb_img"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" grayscale_cam"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 結果を表示")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" numpy "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" np\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" matplotlib"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pyplot "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" plt\n\nplt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("imshow"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("visualization"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vmin"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vmax"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("255")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" interpolation"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'none'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nplt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("show"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"png","data-src":"/image/dog_cam.png",loading:"lazy"}})]),t._v(" "),s("h2",{attrs:{id:"dockerfile"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile"}},[t._v("#")]),t._v(" DockerFile")]),t._v(" "),s("h3",{attrs:{id:"dockerfile-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile-2"}},[t._v("#")]),t._v(" DockerFile")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("# gradcam"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("yolov2\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("FROM")]),t._v(" jupyter"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("base"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("notebook"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("python"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.8")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".6")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("WORKDIR")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("work\n\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("USER")]),t._v(" root\n\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RUN")]),t._v(" sudo apt"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("get")]),t._v(" update\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RUN")]),t._v(" sudo apt"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("get")]),t._v(" install "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("y git\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RUN")]),t._v(" sudo "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DEBIAN_FRONTEND")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"noninteractive"')]),t._v(" apt"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("get")]),t._v(" install "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("y libopencv"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("dev\n\n\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RUN")]),t._v(" pip install "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("upgrade pip\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RUN")]),t._v(" pip install jupyterlab\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RUN")]),t._v(" pip install dataclasses"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.6")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RUN")]),t._v(" pip install dicom"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("factory"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".3")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RUN")]),t._v(" pip install numpy"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.19")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".5")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RUN")]),t._v(" pip install Pillow"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8.1")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RUN")]),t._v(" pip install torch"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.7")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RUN")]),t._v(" pip install torchvision"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.8")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".2")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RUN")]),t._v(" pip install typing"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("extensions"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.7")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".4")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".3")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RUN")]),t._v(" pip install ttach\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RUN")]),t._v(" pip install tqdm\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RUN")]),t._v(" pip install opencv"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("python\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RUN")]),t._v(" pip install ipywidgets\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RUN")]),t._v(" pip install matplotlib\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RUN")]),t._v(" pip install grad"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("cam\n\n\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("WORKDIR")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NB_USER")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("USER")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NB_USER")]),t._v("\n")])])]),s("h3",{attrs:{id:"docker-compose-yml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-yml"}},[t._v("#")]),t._v(" docker-compose.yml")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("version"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3"')]),t._v("\nservices"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  gradcam"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    container_name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" gradcam_60\n    build"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    stdin_open"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    tty"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    volumes"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("jovyan"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("work\n    ports"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8060")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8060")]),t._v(" # "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" Dash\n      "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8888")]),t._v(" # "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" Jupyterlab\n    command"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("  sh "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("c "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jupyter lab'")]),t._v("\n")])])]),s("h3",{attrs:{id:"実行コード"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#実行コード"}},[t._v("#")]),t._v(" 実行コード")]),t._v(" "),s("p",[t._v("DockerFileとdocker-compose.ymlが存在するディレクトリで下記のコードを実行すると，環境が構築されます．")]),t._v(" "),s("p",[t._v("jupyterのURLは"),s("code",[t._v("http://127.0.0.1:60/lab?token=＊＊＊＊")]),t._v("となります．")]),t._v(" "),s("div",{staticClass:"language-py extra-class"},[s("pre",{pre:!0,attrs:{class:"language-py"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 構築用")]),t._v("\ndocker"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("compose up "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("build\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 起動用")]),t._v("\ndocker"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("compose up\n")])])]),s("h2",{attrs:{id:"まとめ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#まとめ"}},[t._v("#")]),t._v(" まとめ")]),t._v(" "),s("p",[t._v("ここでは，CAMの実行できる環境の下作りを実施しました．")]),t._v(" "),s("p",[t._v("次からは，torchvision外からのモデルでも実行できるようにします．")]),t._v(" "),s("h2",{attrs:{id:"参考サイト"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考サイト"}},[t._v("#")]),t._v(" 参考サイト")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/jacobgil/pytorch-grad-cam.git",target:"_blank",rel:"noopener noreferrer"}},[t._v("jacobgil/pytorch-grad-cam"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://qiita.com/bamboo-nova/items/082f71b96b9aca0d5df5",target:"_blank",rel:"noopener noreferrer"}},[t._v("pytorch-gradcamで簡単にGrad-CAMを行う"),s("OutboundLink")],1)]),t._v(" "),s("ClientOnly",[s("CallInArticleAdsense")],1)],1)}),[],!1,null,null,null);a.default=r.exports}}]);