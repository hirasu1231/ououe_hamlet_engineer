(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{472:function(t,a,s){"use strict";s.r(a);var e=s(2),r=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("Python + ESPnetで日本語の文字起こし(ASR)を実施します．"),s("br")]),t._v(" "),s("p",[t._v("今回はGoogle ColabとGoogle Driveを連携させて，notebook形式で実行してます．"),s("br")]),t._v(" "),s("ClientOnly",[s("CallInArticleAdsense")],1),t._v(" "),s("blockquote",[s("p",[t._v("Google Colaboratory（以下Google Colab）は、Google社が無料で提供している機械学習の教育や研究用の開発環境です。開発環境はJupyter Notebookに似たインターフェースを持ち、Pythonの主要なライブラリがプリインストールされています。"),s("br"),t._v("\n引用元："),s("a",{attrs:{href:"https://interface.cqpub.co.jp/ail01/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Google Colabの使い方"),s("OutboundLink")],1)])]),t._v(" "),s("p"),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#google-colabのファイル構成"}},[t._v("Google Colabのファイル構成")])]),s("li",[s("a",{attrs:{href:"#google-driveと連携"}},[t._v("Google Driveと連携")])]),s("li",[s("a",{attrs:{href:"#モジュールのインストール"}},[t._v("モジュールのインストール")])]),s("li",[s("a",{attrs:{href:"#動画から音声へ変換"}},[t._v("動画から音声へ変換")]),s("ul",[s("li",[s("a",{attrs:{href:"#文字起こしの実行"}},[t._v("文字起こしの実行")])])])]),s("li",[s("a",{attrs:{href:"#まとめ"}},[t._v("まとめ")])]),s("li",[s("a",{attrs:{href:"#参考サイト"}},[t._v("参考サイト")])])])]),s("p"),t._v(" "),s("p",[s("a",{attrs:{href:"https://px.a8.net/svt/ejp?a8mat=3HBXCY+4DRW36+50+2HM5Z5",rel:"nofollow"}},[s("img",{attrs:{border:"0",width:"1000",height:"124",alt:"",src:"https://www27.a8.net/svt/bgt?aid=210508450265&wid=001&eno=01&mid=s00000000018015052000&mc=1"}})]),s("img",{attrs:{border:"0",width:"1",height:"1",src:"https://www10.a8.net/0.gif?a8mat=3HBXCY+4DRW36+50+2HM5Z5",alt:""}})]),t._v(" "),s("p",[s("a",{attrs:{href:"https://px.a8.net/svt/ejp?a8mat=3HIN6N+3YAMCY+CO4+6BMG1",rel:"nofollow"}},[s("img",{attrs:{border:"0",width:"1000",height:"124",alt:"",src:"https://www23.a8.net/svt/bgt?aid=210821855239&wid=001&eno=01&mid=s00000001642001062000&mc=1"}})]),s("img",{attrs:{border:"0",width:"1",height:"1",src:"https://www17.a8.net/0.gif?a8mat=3HIN6N+3YAMCY+CO4+6BMG1",alt:""}})]),t._v(" "),s("p",[s("a",{attrs:{href:"https://px.a8.net/svt/ejp?a8mat=3HIN6N+7FBNEA+4AQ0+5YJRM",rel:"nofollow"}},[t._v("全国630店舗以上！もみほぐし・足つぼ・ハンドリフレ・クイックヘッドのリラクゼーション店【りらくる】")]),s("img",{attrs:{border:"0",width:"1",height:"1",src:"https://www15.a8.net/0.gif?a8mat=3HIN6N+7FBNEA+4AQ0+5YJRM",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"google-colabのファイル構成"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#google-colabのファイル構成"}},[t._v("#")]),t._v(" Google Colabのファイル構成")]),t._v(" "),s("p",[t._v("プロジェクトディレクトリはASRとしています．度々，省略しています．")]),t._v(" "),s("p",[t._v("本稿では，"),s("a",{attrs:{href:"https://www.youtube.com/watch?v=us6ClXxB9uY",target:"_blank",rel:"noopener noreferrer"}},[t._v("岡田斗司夫さんの切り抜き動画"),s("OutboundLink")],1),t._v("を文字起こしします．")]),t._v(" "),s("div",{staticClass:"language-init extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("ASR\n├── okada.mp4 <- 文字起こし動画\n├── okada.wav <- 文字起こし音声\n├── 01_okada.wav <- 0~60秒までの音声\n└── ESPnetASR.ipynb <- 実行用ノートブック\n")])])]),s("h2",{attrs:{id:"google-driveと連携"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#google-driveと連携"}},[t._v("#")]),t._v(" Google Driveと連携")]),t._v(" "),s("p",[t._v("Google ColabとGoogle Driveを連携させて，作業ディレクトリを作成します．"),s("br")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Google Driveと連携")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" google"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("colab "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" drive\ndrive"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mount"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/content/drive'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 作業ディレクトリの作成")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("cd "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("content"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("drive"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("MyDrive"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n!mkdir "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p ASR\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("cd ASR\n!ls\n")])])]),s("h2",{attrs:{id:"モジュールのインストール"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#モジュールのインストール"}},[t._v("#")]),t._v(" モジュールのインストール")]),t._v(" "),s("p",[t._v("下記のコマンドでモジュールをインストールします．")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ffmpeg")]),t._v("\n!apt"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("get install ffmpeg\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# pip")]),t._v("\n!pip install torch\n!pip install espnet_model_zoo\n")])])]),s("h2",{attrs:{id:"動画から音声へ変換"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#動画から音声へ変換"}},[t._v("#")]),t._v(" 動画から音声へ変換")]),t._v(" "),s("p",[t._v("ffmpegで動画から音声への変換を実行します．")]),t._v(" "),s("p",[t._v("ESPNetでは下記のwavファイルの設定でないと，ちゃんと文字起こしされません．")]),t._v(" "),s("ul",[s("li",[t._v("Channel num :  1")]),t._v(" "),s("li",[t._v("Sample width :  2")]),t._v(" "),s("li",[t._v("Sampling rate :  16000")])]),t._v(" "),s("p",[t._v("上記の設定を加味した変換は下記の通りとなります．また，あまりに音声データが長いと，メモリーが足りずプログラムが止まるので，本稿では60秒の長さで文字起こしします．")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 動画→音声")]),t._v("\n!ffmpeg "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("i "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"okada.mp4"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ar "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16000")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ac "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("y "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("f wav "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"okada.wav"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 音声の切り抜き")]),t._v("\n!ffmpeg "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("i okada"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wav "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ss "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("t "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("y 01_okada"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wav\n")])])]),s("h3",{attrs:{id:"文字起こしの実行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#文字起こしの実行"}},[t._v("#")]),t._v(" 文字起こしの実行")]),t._v(" "),s("p",[t._v("下記のコードで文字起こしを実行します．")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" soundfile\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" espnet_model_zoo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("downloader "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" ModelDownloader\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" espnet2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("asr_inference "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Speech2Text\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 学習済みをダウンロードし、音声認識モデルを作成")]),t._v("\nd "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ModelDownloader"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nspeech2text "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Speech2Text"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("**")]),t._v("d"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("download_and_unpack"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kan-bayashi/csj_asr_train_asr_transformer_raw_char_sp_valid.acc.ave"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        device"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cuda"')]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# CPU で認識を行う場合は省略")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 音声ファイル読み込み")]),t._v("\nfname "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'01_okada.wav'")]),t._v("\nspeech"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _ "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" soundfile"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 認識させたい音声ファイルを指定")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 認識結果の取得と表示")]),t._v("\nnbests "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" speech2text"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("speech"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("_ "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nbests"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("text"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ＮＨＫのですねあの先週ですね東京ミラクルの第三種ですねえー最近の商品アニメっていう海が放映されたんですけども")]),t._v("\n")])])]),s("h2",{attrs:{id:"まとめ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#まとめ"}},[t._v("#")]),t._v(" まとめ")]),t._v(" "),s("p",[t._v("本稿では，ESPNetによる文字起こしを実装しました．")]),t._v(" "),s("h2",{attrs:{id:"参考サイト"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考サイト"}},[t._v("#")]),t._v(" 参考サイト")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://kan-bayashi.github.io/asj-espnet2-tutorial/#%E3%83%AC%E3%82%B7%E3%83%94%E3%81%AE%E6%A7%8B%E9%80%A0",target:"_blank",rel:"noopener noreferrer"}},[t._v("ESPnet2で始めるEnd-to-End音声処理"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://tech.fusic.co.jp/posts/2021-08-03-espnet/",target:"_blank",rel:"noopener noreferrer"}},[t._v("複雑な音声処理タスクを一気通貫で実装できる! ESPnetの概念と特徴について"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://tech.fusic.co.jp/posts/2021-08-20-ml-espnet-tts-2/",target:"_blank",rel:"noopener noreferrer"}},[t._v("簡単に作れるTTSモデル：ESPnetを用いたつくよみちゃんTTSモデル作成"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://tech.retrieva.jp/entry/2020/12/23/170645",target:"_blank",rel:"noopener noreferrer"}},[t._v("ESPnet による音声認識入門 ～ESPnet Model Zoo 編～"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://qiita.com/kan-bayashi/items/536acaf165344a6d6460",target:"_blank",rel:"noopener noreferrer"}},[t._v("End-to-End音声処理ツールキットESPnetの紹介"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://px.a8.net/svt/ejp?a8mat=3HBXCY+4DRW36+50+2HM5Z5",rel:"nofollow"}},[s("img",{attrs:{border:"0",width:"1000",height:"124",alt:"",src:"https://www27.a8.net/svt/bgt?aid=210508450265&wid=001&eno=01&mid=s00000000018015052000&mc=1"}})]),s("img",{attrs:{border:"0",width:"1",height:"1",src:"https://www10.a8.net/0.gif?a8mat=3HBXCY+4DRW36+50+2HM5Z5",alt:""}})]),t._v(" "),s("p",[s("a",{attrs:{href:"https://px.a8.net/svt/ejp?a8mat=3HIN6N+3YAMCY+CO4+6BMG1",rel:"nofollow"}},[s("img",{attrs:{border:"0",width:"1000",height:"124",alt:"",src:"https://www23.a8.net/svt/bgt?aid=210821855239&wid=001&eno=01&mid=s00000001642001062000&mc=1"}})]),s("img",{attrs:{border:"0",width:"1",height:"1",src:"https://www17.a8.net/0.gif?a8mat=3HIN6N+3YAMCY+CO4+6BMG1",alt:""}})]),t._v(" "),s("p",[s("a",{attrs:{href:"https://px.a8.net/svt/ejp?a8mat=3HIN6N+7FBNEA+4AQ0+5YJRM",rel:"nofollow"}},[t._v("全国630店舗以上！もみほぐし・足つぼ・ハンドリフレ・クイックヘッドのリラクゼーション店【りらくる】")]),s("img",{attrs:{border:"0",width:"1",height:"1",src:"https://www15.a8.net/0.gif?a8mat=3HIN6N+7FBNEA+4AQ0+5YJRM",alt:""}})]),t._v(" "),s("ClientOnly",[s("CallInArticleAdsense")],1)],1)}),[],!1,null,null,null);a.default=r.exports}}]);