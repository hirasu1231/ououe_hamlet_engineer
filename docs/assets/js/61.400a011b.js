(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{433:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("Thin-Plate-Spline-Motion-Modelを実行して，写真を無理やり動かしてみます．")]),t._v(" "),a("blockquote",[a("p",[t._v("Google Colaboratory（以下Google Colab）は、Google社が無料で提供している機械学習の教育や研究用の開発環境です。開発環境はJupyter Notebookに似たインターフェースを持ち、Pythonの主要なライブラリがプリインストールされています。"),a("br"),t._v("\n引用元："),a("a",{attrs:{href:"https://interface.cqpub.co.jp/ail01/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Google Colabの使い方"),a("OutboundLink")],1)])]),t._v(" "),a("ClientOnly",[a("CallInArticleAdsense")],1),t._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#google-driveと連携"}},[t._v("Google Driveと連携")])]),a("li",[a("a",{attrs:{href:"#論文のダウンロードと翻訳"}},[t._v("論文のダウンロードと翻訳")]),a("ul",[a("li",[a("a",{attrs:{href:"#ライブラリのインストール"}},[t._v("ライブラリのインストール")])]),a("li",[a("a",{attrs:{href:"#論文のダウンロードと翻訳"}},[t._v("論文のダウンロードと翻訳")])]),a("li",[a("a",{attrs:{href:"#論文の概要-多分に推測を含む"}},[t._v("論文の概要(多分に推測を含む)")])])])]),a("li",[a("a",{attrs:{href:"#動画化の実装"}},[t._v("動画化の実装")]),a("ul",[a("li",[a("a",{attrs:{href:"#gitのクローン"}},[t._v("gitのクローン")])])])]),a("li",[a("a",{attrs:{href:"#学習済みモデルのダウンロード"}},[t._v("学習済みモデルのダウンロード")])]),a("li",[a("a",{attrs:{href:"#デモの実行"}},[t._v("デモの実行")])]),a("li",[a("a",{attrs:{href:"#オリジナルデータの実行"}},[t._v("オリジナルデータの実行")])]),a("li",[a("a",{attrs:{href:"#まとめ"}},[t._v("まとめ")])]),a("li",[a("a",{attrs:{href:"#参考サイト"}},[t._v("参考サイト")])])])]),a("p"),t._v(" "),a("h2",{attrs:{id:"google-driveと連携"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#google-driveと連携"}},[t._v("#")]),t._v(" Google Driveと連携")]),t._v(" "),a("p",[t._v("Google ColabとGoogle Driveを連携させます．")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Google ColabとGoogle Driveを連携")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" google"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("colab "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" drive\ndrive"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mount"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/content/drive'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 作業ディレクトリの作成")]),t._v("\n!mkdir "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("content"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("drive"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("MyDrive"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("SOTA"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("ThinPlateSplineMotionModel\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 作業ディレクトリの移動")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("cd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("content"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("drive"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("MyDrive"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("SOTA"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("ThinPlateSplineMotionModel\n!ls\n")])])]),a("h2",{attrs:{id:"論文のダウンロードと翻訳"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#論文のダウンロードと翻訳"}},[t._v("#")]),t._v(" 論文のダウンロードと翻訳")]),t._v(" "),a("p",[t._v("下記のコードで，論文のダウンロードと翻訳を実行します．")]),t._v(" "),a("h3",{attrs:{id:"ライブラリのインストール"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ライブラリのインストール"}},[t._v("#")]),t._v(" ライブラリのインストール")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("!apt"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("get update\n!apt install chromium"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("chromedriver\n!cp "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("lib"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("chromium"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("browser"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("chromedriver "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bin")]),t._v("\n\n!pip install selenium\n")])])]),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("!pip install "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("U easynmt\n!pip install fitz\n!pip install PyMuPDF"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.16")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".14")]),t._v("\n")])])]),a("h3",{attrs:{id:"論文のダウンロードと翻訳-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#論文のダウンロードと翻訳-2"}},[t._v("#")]),t._v(" 論文のダウンロードと翻訳")]),t._v(" "),a("p",[t._v("論文のダウンロードと翻訳を実行します．")]),t._v(" "),a("p",[a("code",[t._v("arxiv_download_translate.py")]),t._v("は"),a("a",{attrs:{href:""}}),t._v("を参照してください．")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("!python arxiv_download_translate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2203.14367v2"')]),t._v("\n")])])]),a("h3",{attrs:{id:"論文の概要-多分に推測を含む"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#論文の概要-多分に推測を含む"}},[t._v("#")]),t._v(" 論文の概要(多分に推測を含む)")]),t._v(" "),a("p",[t._v("動画の動きを静止画像にトレースして，アニメーションを作成することは，近年でも研究されてきたが，動画と静止画像に大きな差があれば，アニメーションのトレースがうまく機能しないことが課題でした．")]),t._v(" "),a("p",[t._v("上記の論文では，下記の工夫により前述の問題の解決を目指しました．")]),t._v(" "),a("ul",[a("li",[t._v("薄板スプライン運動推定(おそらく，スプライン補完の発展系)により，ソース画像の特徴マップ(顔や口元かな)を出力の特徴マップ(顔や口元だと思う)を動かす")]),t._v(" "),a("li",[t._v("多解像度閉鎖マスク(解像度を上げつつ，閉じたマスキングをする？)を活用して，欠落した領域をより現実的に復元する")]),t._v(" "),a("li",[t._v("ネットワークがする作業の明確な分割を確保するために、補完(復元)機能の損失を別で算出した")])]),t._v(" "),a("h2",{attrs:{id:"動画化の実装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#動画化の実装"}},[t._v("#")]),t._v(" 動画化の実装")]),t._v(" "),a("h3",{attrs:{id:"gitのクローン"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gitのクローン"}},[t._v("#")]),t._v(" gitのクローン")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# クローン")]),t._v("\n!git clone https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("//")]),t._v("github"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("yoyo"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("nb"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Thin"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Plate"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Spline"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Motion"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Model"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("git\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 移動")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("cd Thin"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Plate"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Spline"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Motion"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Model\n")])])]),a("h2",{attrs:{id:"学習済みモデルのダウンロード"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#学習済みモデルのダウンロード"}},[t._v("#")]),t._v(" 学習済みモデルのダウンロード")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("!mkdir checkpoints\n!wget "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("c https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("//")]),t._v("cloud"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tsinghua"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("edu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cn"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("f"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("da8d61d012014b12a9e4"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("?dl"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("O checkpoints"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("vox"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pth"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tar\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#!wget -c https://cloud.tsinghua.edu.cn/f/483ef53650b14ac7ae70/?dl=1 -O checkpoints/ted.pth.tar")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#!wget -c https://cloud.tsinghua.edu.cn/f/9ec01fa4aaef423c8c02/?dl=1 -O checkpoints/taichi.pth.tar")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#!wget -c https://cloud.tsinghua.edu.cn/f/cd411b334a2e49cdb1e2/?dl=1 -O checkpoints/mgif.pth.tar")]),t._v("\n")])])]),a("h2",{attrs:{id:"デモの実行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#デモの実行"}},[t._v("#")]),t._v(" デモの実行")]),t._v(" "),a("p",[t._v("下記のコードはモデルの設定です．")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" torch\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# モデルの設定")]),t._v("\ndevice "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" torch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("device"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cuda:0'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用する学習済みモデル")]),t._v("\ndataset_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vox'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ['vox', 'taichi', 'ted', 'mgif']")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 動かしたい画像")]),t._v("\nsource_image_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./assets/source.png'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# トレースする動画")]),t._v("\ndriving_video_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./assets/driving.mp4'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 出力動画の名前")]),t._v("\noutput_video_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./generated.mp4'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 設定ファイル")]),t._v("\nconfig_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'config/vox-256.yaml'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用する学習済みモデルのファイル")]),t._v("\ncheckpoint_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'checkpoints/vox.pth.tar'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 補完の仕方")]),t._v("\npredict_mode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'relative'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ['standard', 'relative', 'avd']")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# より良い結果を出力(時間　がかかる)")]),t._v("\nfind_best_frame "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),t._v(" \n\npixel "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("256")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# for vox, taichi and mgif, the resolution is 256*256")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dataset_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ted'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# for ted, the resolution is 384*384")]),t._v("\n    pixel "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("384")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" find_best_frame"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  !pip install face_alignment\n")])])]),a("p",[t._v("動かしたい画像とトレースしたい動画の入力と確認を実装します．")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" imageio\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" numpy "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" np\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" matplotlib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pyplot "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" plt\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" matplotlib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("animation "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" animation\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" skimage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("transform "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" resize\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" IPython"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("display "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" HTML\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" warnings\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" os\nwarnings"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filterwarnings"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ignore"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 警告は無視")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 動かしたい画像を読み込み")]),t._v("\nsource_image "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" imageio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("imread"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("source_image_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# トレースする動画の読み込み")]),t._v("\nreader "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" imageio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_reader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("driving_video_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 画像の整形")]),t._v("\nsource_image "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" resize"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("source_image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pixel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pixel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# FPSを設定")]),t._v("\nfps "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" reader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_meta_data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fps'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 動画をフレーム毎で格納(上のFPSを使う)")]),t._v("\ndriving_video "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" im "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" reader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        driving_video"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("append"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("im"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("except")]),t._v(" RuntimeError"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pass")]),t._v("\nreader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("close"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# フレームリストをリザイズ")]),t._v("\ndriving_video "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("resize"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("frame"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pixel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pixel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" frame "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" driving_video"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Colabで2つの動画を並べて再生")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("display")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" driving"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" generated"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    fig "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" plt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("figure"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("figsize"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("generated "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("is")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    ims "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("range")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("len")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("driving"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        cols "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        cols"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("append"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("driving"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" generated "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("is")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            cols"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("append"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("generated"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        im "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" plt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("imshow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("np"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("concatenate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cols"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" axis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" animated"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        plt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("axis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'off'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        ims"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("append"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("im"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    ani "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" animation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ArtistAnimation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ims"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" interval"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" repeat_delay"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    plt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("close"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ani\n    \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 動画を再生")]),t._v("\nHTML"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("display"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("source_image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" driving_video"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("to_html5_video"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("video",{attrs:{width:"560",height:"240",controls:""}},[a("source",{attrs:{src:"/video/TPSMM02.mp4",type:"video/mp4"}}),t._v("\n  Your browser does not support the video tag.\n")]),t._v(" "),a("p",[t._v("デモの設定を呼び出す．")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" demo "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" load_checkpoints\ninpainting"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" kp_detector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dense_motion_network"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" avd_network "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" load_checkpoints"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("config_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" config_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" checkpoint_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" checkpoint_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" device "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" device"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("下記のコードでトレースを実行します．")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" demo "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" make_animation\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" skimage "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" img_as_ubyte\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 最高品質でのトレース")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" predict_mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'relative'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("and")]),t._v(" find_best_frame"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" demo "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" find_best_frame "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" _find\n    i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" _find"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("source_image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" driving_video"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" device"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cpu'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Best frame: "')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("str")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    driving_forward "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" driving_video"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    driving_backward "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" driving_video"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    predictions_forward "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" make_animation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("source_image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" driving_forward"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" inpainting"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" kp_detector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dense_motion_network"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" avd_network"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" device "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" device"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" predict_mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    predictions_backward "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" make_animation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("source_image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" driving_backward"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" inpainting"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" kp_detector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dense_motion_network"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" avd_network"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" device "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" device"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" predict_mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    predictions "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" predictions_backward"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" predictions_forward"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# まあまあの品質のトレース")]),t._v("\n    predictions "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" make_animation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("source_image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" driving_video"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" inpainting"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" kp_detector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dense_motion_network"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" avd_network"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" device "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" device"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" predict_mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 出力動画の保存")]),t._v("\nimageio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mimsave"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("output_video_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("img_as_ubyte"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("frame"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" frame "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" predictions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fps"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("fps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 動画を再生")]),t._v("\nHTML"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("display"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("source_image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" driving_video"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" predictions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("to_html5_video"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("video",{attrs:{width:"560",height:"240",controls:""}},[a("source",{attrs:{src:"/video/TPSMM03.mp4",type:"video/mp4"}}),t._v("\n  Your browser does not support the video tag.\n")]),t._v(" "),a("h2",{attrs:{id:"オリジナルデータの実行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#オリジナルデータの実行"}},[t._v("#")]),t._v(" オリジナルデータの実行")]),t._v(" "),a("p",[t._v("岸田さんの画像でやってみます．")]),t._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"/image/TPSMM01.jpeg",loading:"lazy"}})]),t._v(" "),a("p",[t._v("変更する箇所の最初の読み込みの部分のみです．")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" torch\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# モデルの設定")]),t._v("\ndevice "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" torch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("device"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cuda:0'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用する学習済みモデル")]),t._v("\ndataset_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vox'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ['vox', 'taichi', 'ted', 'mgif']")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 動かしたい画像")]),t._v("\nsource_image_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./assets/Fumio_Kishida_20211004.jpeg'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# トレースする動画")]),t._v("\ndriving_video_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./assets/driving.mp4'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 出力動画の名前")]),t._v("\noutput_video_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./kishida_generated.mp4'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 設定ファイル")]),t._v("\nconfig_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'config/vox-256.yaml'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用する学習済みモデルのファイル")]),t._v("\ncheckpoint_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'checkpoints/vox.pth.tar'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 補完の仕方")]),t._v("\npredict_mode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'relative'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ['standard', 'relative', 'avd']")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# より良い結果を出力(時間がかかる)")]),t._v("\nfind_best_frame "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),t._v(" \n\npixel "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("256")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# for vox, taichi and mgif, the resolution is 256*256")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dataset_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ted'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# for ted, the resolution is 384*384")]),t._v("\n    pixel "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("384")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" find_best_frame"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  !pip install face_alignment\n")])])]),a("video",{attrs:{width:"560",height:"240",controls:""}},[a("source",{attrs:{src:"/video/TPSMM04.mp4",type:"video/mp4"}}),t._v("\n  Your browser does not support the video tag.\n")]),t._v(" "),a("h2",{attrs:{id:"まとめ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#まとめ"}},[t._v("#")]),t._v(" まとめ")]),t._v(" "),a("p",[t._v("Thin-Plate-Spline-Motion-Modelを実行して，写真を無理やり動かしてみました．")]),t._v(" "),a("h2",{attrs:{id:"参考サイト"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考サイト"}},[t._v("#")]),t._v(" 参考サイト")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://paperswithcode.com/paper/thin-plate-spline-motion-model-for-image",target:"_blank",rel:"noopener noreferrer"}},[t._v("SOTA thin-plate-spline-motion-mode"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://arxiv.org/abs/2203.14367v2",target:"_blank",rel:"noopener noreferrer"}},[t._v("arxiv thin-plate-spline-motion-mode"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/yoyo-nb/thin-plate-spline-motion-model",target:"_blank",rel:"noopener noreferrer"}},[t._v("yoyo-nb/thin-plate-spline-motion-model"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://colab.research.google.com/drive/1DREfdpnaBhqISg0fuQlAAIwyGVn1loH_?usp=sharing",target:"_blank",rel:"noopener noreferrer"}},[t._v("colab demo"),a("OutboundLink")],1)]),t._v(" "),a("ClientOnly",[a("CallInArticleAdsense")],1),t._v(" "),a("p",[a("a",{attrs:{href:"//af.moshimo.com/af/c/click?a_id=2604050&p_id=1555&pc_id=2816&pl_id=29835&guid=ON",rel:"nofollow",referrerpolicy:"no-referrer-when-downgrade"}},[a("img",{staticStyle:{border:"none"},attrs:{src:"//image.moshimo.com/af-img/0866/000000029835.jpg",width:"728",height:"90"}})]),a("img",{staticStyle:{border:"none"},attrs:{src:"//i.moshimo.com/af/i/impression?a_id=2604050&p_id=1555&pc_id=2816&pl_id=29835",width:"1",height:"1"}})]),t._v(" "),a("p",[a("a",{attrs:{href:"//af.moshimo.com/af/c/click?a_id=2641145&p_id=1770&pc_id=3386&pl_id=25847&guid=ON",rel:"nofollow",referrerpolicy:"no-referrer-when-downgrade"}},[a("img",{staticStyle:{border:"none"},attrs:{src:"//image.moshimo.com/af-img/1115/000000025847.png",width:"728",height:"90"}})]),a("img",{staticStyle:{border:"none"},attrs:{src:"//i.moshimo.com/af/i/impression?a_id=2641145&p_id=1770&pc_id=3386&pl_id=25847",width:"1",height:"1"}})])],1)}),[],!1,null,null,null);s.default=e.exports}}]);