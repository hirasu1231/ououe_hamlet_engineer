(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{471:function(t,e,a){"use strict";a.r(e);var r=a(2),n=Object(r.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("DockerでQGISがインストールされたコンテナ(Ubuntu20.04)を作成し起動します．")]),t._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#ファイル構成"}},[t._v("ファイル構成")])]),a("li",[a("a",{attrs:{href:"#dockerfileの作成"}},[t._v("Dockerfileの作成")])]),a("li",[a("a",{attrs:{href:"#docker-compose"}},[t._v("docker-compose")])]),a("li",[a("a",{attrs:{href:"#コンテナの起動"}},[t._v("コンテナの起動")])]),a("li",[a("a",{attrs:{href:"#サーバーに接続"}},[t._v("サーバーに接続")])]),a("li",[a("a",{attrs:{href:"#まとめ"}},[t._v("まとめ")])]),a("li",[a("a",{attrs:{href:"#参考サイト"}},[t._v("参考サイト")])])])]),a("p"),t._v(" "),a("p",[a("a",{attrs:{href:"https://px.a8.net/svt/ejp?a8mat=3HBXCY+4DRW36+50+2HM5Z5",rel:"nofollow"}},[a("img",{attrs:{border:"0",width:"1000",height:"124",alt:"",src:"https://www27.a8.net/svt/bgt?aid=210508450265&wid=001&eno=01&mid=s00000000018015052000&mc=1"}})]),a("img",{attrs:{border:"0",width:"1",height:"1",src:"https://www10.a8.net/0.gif?a8mat=3HBXCY+4DRW36+50+2HM5Z5",alt:""}})]),t._v(" "),a("p",[a("a",{attrs:{href:"https://px.a8.net/svt/ejp?a8mat=3HIN6N+3YAMCY+CO4+6BMG1",rel:"nofollow"}},[a("img",{attrs:{border:"0",width:"1000",height:"124",alt:"",src:"https://www23.a8.net/svt/bgt?aid=210821855239&wid=001&eno=01&mid=s00000001642001062000&mc=1"}})]),a("img",{attrs:{border:"0",width:"1",height:"1",src:"https://www17.a8.net/0.gif?a8mat=3HIN6N+3YAMCY+CO4+6BMG1",alt:""}})]),t._v(" "),a("p",[a("a",{attrs:{href:"https://px.a8.net/svt/ejp?a8mat=3HIN6N+7FBNEA+4AQ0+5YJRM",rel:"nofollow"}},[t._v("全国630店舗以上！もみほぐし・足つぼ・ハンドリフレ・クイックヘッドのリラクゼーション店【りらくる】")]),a("img",{attrs:{border:"0",width:"1",height:"1",src:"https://www15.a8.net/0.gif?a8mat=3HIN6N+7FBNEA+4AQ0+5YJRM",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"ファイル構成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ファイル構成"}},[t._v("#")]),t._v(" ファイル構成")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("qgis_docker\n├── /workspace\n├── docker-compose.yml\n└── DockerFile\n")])])]),a("h2",{attrs:{id:"dockerfileの作成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerfileの作成"}},[t._v("#")]),t._v(" Dockerfileの作成")]),t._v(" "),a("p",[t._v("下記のサイトのDockerfileから一部を書き換えます．")]),t._v(" "),a("p",[a("a",{attrs:{href:"http://serverarekore.blogspot.com/2020/12/dockerqgisxfcetigervncubuntu2004.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("DockerでQGISとXfce、TigerVNCがインストールされたコンテナ(Ubuntu20.04)を作成する"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("書き換えは，下記の通りです．\n"),a("strong",[t._v("QGISのキーを入力")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("  && apt-key adv --keyserver keyserver.ubuntu.com --recv-key 46B5721DBBD2996A \\<br>\n")])])]),a("p",[a("strong",[t._v("gnome-screensaver前にアップデート")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("  && apt-get update \\\n  && apt-get -y install gnome-screensaver \\\n")])])]),a("p",[a("strong",[t._v("DockerFile")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("from ubuntu:20.04\n\nENV DEBIAN_FRONTEND=noninteractive\nrun apt-get update \\\n    && apt-get -y -o Dpkg::Options::=\"--force-confdef\" -o Dpkg::Options::=\"--force-confold\" upgrade \\\n    && apt-get install -y language-pack-ja-base language-pack-ja \\\n    && ln -sf /usr/share/zoneinfo/Asia/Tokyo /etc/localtime \\\n    && echo 'Asia/Tokyo' > /etc/timezone \\\n    && locale-gen ja_JP.UTF-8 \\\n    && echo 'LC_ALL=ja_JP.UTF-8' > /etc/default/locale \\\n    && echo 'LANG=ja_JP.UTF-8' >> /etc/default/locale\nenv LANG=ja_JP.UTF-8 \\\n    LANGUAGE=ja_JP.UTF-8 \\\n    LC_ALL=ja_JP.UTF-8\nrun apt-get -y install \\\n        xubuntu-desktop \\\n        xfce4-terminal \\\n        tigervnc-standalone-server \\\n        expect \\\n        fcitx-mozc \\\n        fonts-ipafont-gothic \\\n        fonts-ipafont-mincho \\\n        vim \\\n        gvfs-bin \\\n        xdg-utils \\\n    && wget -qO - https://qgis.org/downloads/qgis-2020.gpg.key | sudo gpg --no-default-keyring --keyring gnupg-ring:/etc/apt/trusted.gpg.d/qgis-archive.gpg --import \\\n    && chmod a+r /etc/apt/trusted.gpg.d/qgis-archive.gpg \\\n    && echo \"deb http://qgis.org/debian focal main\" >> /etc/apt/sources.list \\\n    && apt-key adv --keyserver keyserver.ubuntu.com --recv-key 46B5721DBBD2996A \\\n    && apt-get update \\\n    && apt-get -y install qgis python-qgis qgis-plugin-grass \\\n    && apt-get -y install unzip \\\n    && wget http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/110m/cultural/ne_110m_admin_0_countries.zip \\\n    && unzip ne_110m_admin_0_countries.zip \\\n    && apt-get -y remove --purge light-locker \\\n    && apt-get update \\\n    && apt-get -y install gnome-screensaver \\\n    && im-config -n fcitx \\\n    && apt-get clean \\\n    && rm -rf /var/cache/apt/archives/* \\\n    && rm -rf /var/lib/apt/lists/* \\\n    && groupadd -g 1000 ubuntu \\\n    && useradd -d /home/ubuntu -m -s /bin/bash -u 1000 -g 1000 ubuntu \\\n    && echo 'ubuntu:ubuntu' | chpasswd \\\n    && echo \"ubuntu ALL=NOPASSWD: ALL\" >> /etc/sudoers \\\n    && echo 'spawn \"tigervncpasswd\"' >> /tmp/initpass \\\n    && echo 'expect \"Password:\"' >> /tmp/initpass \\\n    && echo 'send \"ubuntu\\\\r\"' >> /tmp/initpass \\\n    && echo 'expect \"Verify:\"' >> /tmp/initpass \\\n    && echo 'send \"ubuntu\\\\r\"' >> /tmp/initpass \\\n    && echo 'expect \"Would you like to enter a view-only password (y/n)?\"' >> /tmp/initpass \\\n    && echo 'send \"n\\\\r\"' >> /tmp/initpass \\\n    && echo 'expect eof' >> /tmp/initpass \\\n    && echo 'exit' >> /tmp/initpass \\\n    && sudo -u ubuntu -H /bin/bash -c '/usr/bin/expect /tmp/initpass' \\\n    && mkdir -p /home/ubuntu/.vnc \\\n    && chown ubuntu:ubuntu /home/ubuntu/.vnc \\\n    && echo '#!/bin/sh' >> /home/ubuntu/.vnc/xstartup \\\n    && echo 'export LANG=ja_JP.UTF-8' >> /home/ubuntu/.vnc/xstartup \\\n    && echo 'export LC_ALL=ja_JP.UTF-8' >> /home/ubuntu/.vnc/xstartup \\\n    && echo 'export XMODIFIERS=@im=fcitx' >> /home/ubuntu/.vnc/xstartup \\\n    && echo 'export GTK_IM_MODULE=fcitx' >> /home/ubuntu/.vnc/xstartup \\\n    && echo 'fcitx -r -d &' >> /home/ubuntu/.vnc/xstartup \\\n    && echo 'exec startxfce4' >> /home/ubuntu/.vnc/xstartup \\\n    && chmod +x /home/ubuntu/.vnc/xstartup \\\n    && mkdir -p /home/ubuntu/data \\\n    && chown -R ubuntu:ubuntu /home/ubuntu/data\n\nexpose 5901\nvolume [\"/home/ubuntu/data\"]\n")])])]),a("h2",{attrs:{id:"docker-compose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose"}},[t._v("#")]),t._v(" docker-compose")]),t._v(" "),a("p",[t._v("docker-compose.ymlを作成します．")]),t._v(" "),a("p",[a("strong",[t._v("docker-compose.yml")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('version: "3"\nservices:\n  qgis_vnc:\n    build:\n      context: .\n      dockerfile: Dockerfile\n    user: 1000:1000\n    ports:\n      - 5901:5901\n    tty: true\n    privileged: true\n    volumes:\n      - ./workspace:/home/ubuntu/data \n    working_dir: /home/ubuntu/data \n    command: /usr/bin/vncserver :1 -localhost no -geometry 1152x864 -alwaysshared -fg\n')])])]),a("h2",{attrs:{id:"コンテナの起動"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#コンテナの起動"}},[t._v("#")]),t._v(" コンテナの起動")]),t._v(" "),a("p",[t._v("下記のコードでimage構築，コンテナ起動，コンテナ停止を実行します．")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# image構築\ndocker-compose build --no-cache\n\n# コンテナ起動\ndocker-compose up -d\n\n# コンテナ停止\ndocker-compose stop\n")])])]),a("h2",{attrs:{id:"サーバーに接続"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#サーバーに接続"}},[t._v("#")]),t._v(" サーバーに接続")]),t._v(" "),a("p",[t._v("Finderのメニューバーの「移動→サーバへ接続→vnc://localhost:5901」へ接続します．")]),t._v(" "),a("p",[t._v("パスワードはubuntuです．")]),t._v(" "),a("p",[a("a",{attrs:{href:"/image/qgis_sever.png"}})]),t._v(" "),a("h2",{attrs:{id:"まとめ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#まとめ"}},[t._v("#")]),t._v(" まとめ")]),t._v(" "),a("p",[t._v("ここまでで，DockerでQGISがインストールされたコンテナ(Ubuntu20.04)を作成し起動までしました．")]),t._v(" "),a("h2",{attrs:{id:"参考サイト"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考サイト"}},[t._v("#")]),t._v(" 参考サイト")]),t._v(" "),a("p",[a("a",{attrs:{href:"http://serverarekore.blogspot.com/2020/12/dockerqgisxfcetigervncubuntu2004.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("DockerでQGISとXfce、TigerVNCがインストールされたコンテナ(Ubuntu20.04)を作成する"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://docs.qgis.org/3.10/ja/docs/user_manual/working_with_ogc/server/containerized_deployment.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("QGIS Documentation 18.2.5. コンテナ化された配備"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://gis.stackexchange.com/questions/332245/error-adding-qgis-org-repository-public-key-to-apt-keyring",target:"_blank",rel:"noopener noreferrer"}},[t._v("Error adding qgis.org repository public key to apt keyring"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.fixes.pub/ubuntu/713313.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("apt : Ubuntu 20.04にgnome-control-centerをインストールする方法"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://qiita.com/tegnike/items/bcdcee0320e11a928d46",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker-compose "),a("code",[t._v("up")]),t._v(" とか "),a("code",[t._v("build")]),t._v(" とか "),a("code",[t._v("start")]),t._v(" とかの違いを理解できていなかったのでまとめてみた"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://qiita.com/acro5piano/items/8cd987253cb205cefbb5",target:"_blank",rel:"noopener noreferrer"}},[t._v("Dockerで実行ユーザーとグループを指定する"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://qiita.com/syoyo/items/6fa6597b7a6625000e33",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker でユーザ名を指定してコンテナを起動する"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://qiita.com/tksugimoto/items/23fcce1b067661e8aa46",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker-compose の ports 指定まとめ"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://qiita.com/seigot/items/eef9da58c74eb080617b",target:"_blank",rel:"noopener noreferrer"}},[t._v("Dockerへvnc接続する"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://qiita.com/ponsuke0531/items/7e8e5081993a30afdc4a",target:"_blank",rel:"noopener noreferrer"}},[t._v("Dockerコンテナの内部IPアドレスを確認する方法"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/kartoza/docker-qgis-desktop",target:"_blank",rel:"noopener noreferrer"}},[t._v("kartoza/docker-qgis-desktop"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/rafdouglas/qgis_desktop_docker",target:"_blank",rel:"noopener noreferrer"}},[t._v("rafdouglas/qgis_desktop_docker"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://px.a8.net/svt/ejp?a8mat=3HBXCY+4DRW36+50+2HM5Z5",rel:"nofollow"}},[a("img",{attrs:{border:"0",width:"1000",height:"124",alt:"",src:"https://www27.a8.net/svt/bgt?aid=210508450265&wid=001&eno=01&mid=s00000000018015052000&mc=1"}})]),a("img",{attrs:{border:"0",width:"1",height:"1",src:"https://www10.a8.net/0.gif?a8mat=3HBXCY+4DRW36+50+2HM5Z5",alt:""}})]),t._v(" "),a("p",[a("a",{attrs:{href:"https://px.a8.net/svt/ejp?a8mat=3HIN6N+3YAMCY+CO4+6BMG1",rel:"nofollow"}},[a("img",{attrs:{border:"0",width:"1000",height:"124",alt:"",src:"https://www23.a8.net/svt/bgt?aid=210821855239&wid=001&eno=01&mid=s00000001642001062000&mc=1"}})]),a("img",{attrs:{border:"0",width:"1",height:"1",src:"https://www17.a8.net/0.gif?a8mat=3HIN6N+3YAMCY+CO4+6BMG1",alt:""}})]),t._v(" "),a("p",[a("a",{attrs:{href:"https://px.a8.net/svt/ejp?a8mat=3HIN6N+7FBNEA+4AQ0+5YJRM",rel:"nofollow"}},[t._v("全国630店舗以上！もみほぐし・足つぼ・ハンドリフレ・クイックヘッドのリラクゼーション店【りらくる】")]),a("img",{attrs:{border:"0",width:"1",height:"1",src:"https://www15.a8.net/0.gif?a8mat=3HIN6N+7FBNEA+4AQ0+5YJRM",alt:""}})])])}),[],!1,null,null,null);e.default=n.exports}}]);