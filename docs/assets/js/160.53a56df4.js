(window.webpackJsonp=window.webpackJsonp||[]).push([[160],{463:function(t,s,a){"use strict";a.r(s);var n=a(2),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("OpenStreetMapから東北地方の道路データを整理します。")]),t._v(" "),a("ClientOnly",[a("CallInArticleAdsense")],1),t._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#ファイル構成"}},[t._v("ファイル構成")])]),a("li",[a("a",{attrs:{href:"#ライブラリのインストール"}},[t._v("ライブラリのインストール")])]),a("li",[a("a",{attrs:{href:"#osmの読み込み"}},[t._v("OSMの読み込み")])]),a("li",[a("a",{attrs:{href:"#道路種別の選定"}},[t._v("道路種別の選定")])]),a("li",[a("a",{attrs:{href:"#keplerで確認"}},[t._v("Keplerで確認")])]),a("li",[a("a",{attrs:{href:"#リンク長の算出"}},[t._v("リンク長の算出")])]),a("li",[a("a",{attrs:{href:"#リンクの始点終点座標の整理"}},[t._v("リンクの始点終点座標の整理")]),a("ul",[a("li",[a("a",{attrs:{href:"#始点終点座標を抽出"}},[t._v("始点終点座標を抽出")])]),a("li",[a("a",{attrs:{href:"#上り下り-順流・逆流-のidを付与"}},[t._v("上り下り(順流・逆流)のIDを付与")])]),a("li",[a("a",{attrs:{href:"#始点終点ノードにidを付与"}},[t._v("始点終点ノードにIDを付与")])])])]),a("li",[a("a",{attrs:{href:"#csvの出力"}},[t._v("CSVの出力")])]),a("li",[a("a",{attrs:{href:"#qgisで投影"}},[t._v("QGISで投影")])]),a("li",[a("a",{attrs:{href:"#まとめ"}},[t._v("まとめ")])]),a("li",[a("a",{attrs:{href:"#参考サイト"}},[t._v("参考サイト")])])])]),a("p"),t._v(" "),a("h2",{attrs:{id:"ファイル構成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ファイル構成"}},[t._v("#")]),t._v(" ファイル構成")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("project_dir\n├── /data\n│   ├── /R2_boundary/04_miyagi/04_miyagi.shp\n│   ├── /osm/tohoku/gis_osm_roads_free_1.shp\n│   └── (省略)\n└── merge_bound.ipynb <- 実行用ノートブック\n")])])]),a("h2",{attrs:{id:"ライブラリのインストール"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ライブラリのインストール"}},[t._v("#")]),t._v(" ライブラリのインストール")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("!pip install keplergl\n!pip install geopandas\n!pip install sodapy\n!jupyter labextension install @jupyter"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("widgets"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("jupyterlab"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("manager keplergl"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("jupyter\n\n!pip install geopy\n!pip install simpledbf\n")])])]),a("h2",{attrs:{id:"osmの読み込み"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#osmの読み込み"}},[t._v("#")]),t._v(" OSMの読み込み")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" pandas "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" pd\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" simpledbf "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Dbf5\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" geopandas "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" gpd\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" keplergl "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" KeplerGl\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" base64\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" geopy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("distance "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" geodesic\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" hashlib\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# # DBFの読み込み")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# dbf = Dbf5('\"./data/osm/tohoku/gis_osm_roads_free_1.dbf')")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# df = dbf.to_dataframe()")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# shpファイル読込")]),t._v("\ngdf "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" gpd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read_file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./data/osm/tohoku/gis_osm_roads_free_1.shp"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ngdf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("head"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("table",[a("thead",[a("tr",[a("th",[t._v("osm_id")]),t._v(" "),a("th",[t._v("code")]),t._v(" "),a("th",[t._v("fclass")]),t._v(" "),a("th",[t._v("name")]),t._v(" "),a("th",[t._v("ref")]),t._v(" "),a("th",[t._v("oneway")]),t._v(" "),a("th",[t._v("maxspeed")]),t._v(" "),a("th",[t._v("layer")]),t._v(" "),a("th",[t._v("bridge")]),t._v(" "),a("th",[t._v("tunnel")]),t._v(" "),a("th",[t._v("geometry")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("20264905")]),t._v(" "),a("td",[t._v("5111")]),t._v(" "),a("td",[t._v("motorway")]),t._v(" "),a("td",[t._v("東北自動車道")]),t._v(" "),a("td",[t._v("E4")]),t._v(" "),a("td",[t._v("F")]),t._v(" "),a("td",[t._v("100")]),t._v(" "),a("td",[t._v("0")]),t._v(" "),a("td",[t._v("F")]),t._v(" "),a("td",[t._v("F")]),t._v(" "),a("td",[t._v("LINESTRING (141.09415 38.80402, 141.09454 38.8...")])]),t._v(" "),a("tr",[a("td",[t._v("22762217")]),t._v(" "),a("td",[t._v("5121")]),t._v(" "),a("td",[t._v("unclassified")]),t._v(" "),a("td",[t._v("None")]),t._v(" "),a("td",[t._v("None")]),t._v(" "),a("td",[t._v("B")]),t._v(" "),a("td",[t._v("0")]),t._v(" "),a("td",[t._v("0")]),t._v(" "),a("td",[t._v("F")]),t._v(" "),a("td",[t._v("F")]),t._v(" "),a("td",[t._v("LINESTRING (140.88676 38.30354, 140.88661 38.3...")])]),t._v(" "),a("tr",[a("td",[t._v("22762218")]),t._v(" "),a("td",[t._v("5122")]),t._v(" "),a("td",[t._v("residential")]),t._v(" "),a("td",[t._v("None")]),t._v(" "),a("td",[t._v("None")]),t._v(" "),a("td",[t._v("B")]),t._v(" "),a("td",[t._v("0")]),t._v(" "),a("td",[t._v("0")]),t._v(" "),a("td",[t._v("F")]),t._v(" "),a("td",[t._v("F")]),t._v(" "),a("td",[t._v("LINESTRING (140.88614 38.30239, 140.88638 38.3...")])])])]),t._v(" "),a("h2",{attrs:{id:"道路種別の選定"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#道路種別の選定"}},[t._v("#")]),t._v(" 道路種別の選定")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://wiki.openstreetmap.org/wiki/JA:Key:highway",target:"_blank",rel:"noopener noreferrer"}},[t._v("OSM fclass"),a("OutboundLink")],1),t._v("を参考に、道路種別の選定します。")]),t._v(" "),a("ul",[a("li",[t._v("footway：歩道")]),t._v(" "),a("li",[t._v("living_street：生活道路")]),t._v(" "),a("li",[t._v("motorway:自専道")]),t._v(" "),a("li",[t._v("motorway_link:自専道(ランプ)")]),t._v(" "),a("li",[t._v("pedestrian:歩道")]),t._v(" "),a("li",[t._v("primary:主要地方道")]),t._v(" "),a("li",[t._v("residential:居住地域内道路")]),t._v(" "),a("li",[t._v("secondary:都道府県道")]),t._v(" "),a("li",[t._v("service:私道")]),t._v(" "),a("li",[t._v("steps:階段")]),t._v(" "),a("li",[t._v("tertiary:市町村道")]),t._v(" "),a("li",[t._v("tertiary_link:市町村道(ランプ)")]),t._v(" "),a("li",[t._v("track:農道・林道,")]),t._v(" "),a("li",[t._v("track_grade1:1級_農道・林道,")]),t._v(" "),a("li",[t._v("track_grade4:4級_農道・林道,")]),t._v(" "),a("li",[t._v("track_grade5:5級_農道・林道,")]),t._v(" "),a("li",[t._v("trunk:国道")]),t._v(" "),a("li",[t._v("trunk_link:国道(ランプ)")])]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 道路酒別を抽出")]),t._v("\ngdf2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" gdf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("gdf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fclass"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"motorway"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"motorway_link"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n                               "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"primary"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"secondary"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                               "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tertiary"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tertiary_link"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                               "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"living_street"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                               "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"trunk"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"trunk_link"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 0~10行を抽出(短時間で確認したいので)")]),t._v("\ngdf2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" gdf2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("reset_index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("drop"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ngdf2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("head"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h2",{attrs:{id:"keplerで確認"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#keplerで確認"}},[t._v("#")]),t._v(" Keplerで確認")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# データの読み込み")]),t._v("\nmap1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" KeplerGl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("height"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("400")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nmap1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add_data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("gdf2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'data1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# htmlで表記")]),t._v("\norig_html "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("str")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("map1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_repr_html_"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'utf-8'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nb64d_html "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" base64"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("b64encode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("orig_html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("encode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'utf-8'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("decode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'utf-8'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nframed_html "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string-interpolation"}},[a("span",{pre:!0,attrs:{class:"token string"}},[t._v("f'<iframe src=\"data:text/html;base64,")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("b64d_html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('" style="width:95%; height: 600px">\'')])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" IPython\nIPython"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("display"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("HTML"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("framed_html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"/image/kepler_osm.png",loading:"lazy"}})]),t._v(" "),a("h2",{attrs:{id:"リンク長の算出"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#リンク長の算出"}},[t._v("#")]),t._v(" リンク長の算出")]),t._v(" "),a("p",[t._v("LINESTRINGからリンク長を算出します")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# リンク長の算出")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("link_length")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("latlons"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    dis "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("range")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("len")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("latlons"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        _prev "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" latlons"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("split"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('" "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        _next "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" latlons"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("split"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('" "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 逐次加算")]),t._v("\n        dis "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" geodesic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_prev"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _prev"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_next"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _next"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("km\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" dis\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# LINESTRINGを整理")]),t._v("\ngeometry "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" gdf2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"geometry"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("astype"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("str")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("apply")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("lambda")]),t._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("replace"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"LINESTRING ("')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("replace"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('")"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 座標リストに整形")]),t._v("\nlatlons "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" geometry"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("apply")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("lambda")]),t._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("split"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('", "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# リンク長の算出")]),t._v("\ngdf2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"length"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" latlons"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("apply")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("lambda")]),t._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" link_length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ngdf2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("head"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("table",[a("thead",[a("tr",[a("th",[t._v("osm_id")]),t._v(" "),a("th",[t._v("code")]),t._v(" "),a("th",[t._v("fclass")]),t._v(" "),a("th",[t._v("name")]),t._v(" "),a("th",[t._v("ref")]),t._v(" "),a("th",[t._v("oneway")]),t._v(" "),a("th",[t._v("maxspeed")]),t._v(" "),a("th",[t._v("layer")]),t._v(" "),a("th",[t._v("bridge")]),t._v(" "),a("th",[t._v("tunnel")]),t._v(" "),a("th",[t._v("geometry")]),t._v(" "),a("th",[t._v("length")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("20264905")]),t._v(" "),a("td",[t._v("5111")]),t._v(" "),a("td",[t._v("motorway")]),t._v(" "),a("td",[t._v("東北自動車道")]),t._v(" "),a("td",[t._v("E4")]),t._v(" "),a("td",[t._v("F")]),t._v(" "),a("td",[t._v("100")]),t._v(" "),a("td",[t._v("0")]),t._v(" "),a("td",[t._v("F")]),t._v(" "),a("td",[t._v("F")]),t._v(" "),a("td",[t._v("LINESTRING (141.0941549000000066 38.8040227999...")]),t._v(" "),a("td",[t._v("3.944538")])]),t._v(" "),a("tr",[a("td",[t._v("22787759")]),t._v(" "),a("td",[t._v("5113")]),t._v(" "),a("td",[t._v("primary")]),t._v(" "),a("td",[t._v("県道22号仙台泉線（勾当台通り）")]),t._v(" "),a("td",[t._v("22")]),t._v(" "),a("td",[t._v("B")]),t._v(" "),a("td",[t._v("60")]),t._v(" "),a("td",[t._v("0")]),t._v(" "),a("td",[t._v("F")]),t._v(" "),a("td",[t._v("F")]),t._v(" "),a("td",[t._v("LINESTRING (140.8690382000000056 38.2722394999...")]),t._v(" "),a("td",[t._v("0.381072")])])])]),t._v(" "),a("h2",{attrs:{id:"リンクの始点終点座標の整理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#リンクの始点終点座標の整理"}},[t._v("#")]),t._v(" リンクの始点終点座標の整理")]),t._v(" "),a("p",[t._v("OSMには交通流の上り下りがないので、上り下りの要素を追記します。")]),t._v(" "),a("p",[t._v("一通の道路も存在するはずだが、一旦考慮しないものとします。\n​\n追記方法は下記に示す。")]),t._v(" "),a("ul",[a("li",[t._v("始点終点座標を抽出")]),t._v(" "),a("li",[t._v("上り下り(順流・逆流)のIDを付与")]),t._v(" "),a("li",[t._v("始点終点ノードにIDを付与")])]),t._v(" "),a("h3",{attrs:{id:"始点終点座標を抽出"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#始点終点座標を抽出"}},[t._v("#")]),t._v(" 始点終点座標を抽出")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 始点の緯度経度を抽出")]),t._v("\ninit_lon "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" geometry"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("apply")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("lambda")]),t._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("split"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('", "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("split"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('" "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ninit_lat "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" geometry"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("apply")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("lambda")]),t._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("split"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('", "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("split"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('" "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 終点の緯度経度を抽出")]),t._v("\nterm_lon "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" geometry"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("apply")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("lambda")]),t._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("split"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('", "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("split"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('" "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nterm_lat "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" geometry"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("apply")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("lambda")]),t._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("split"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('", "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("split"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('" "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h3",{attrs:{id:"上り下り-順流・逆流-のidを付与"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#上り下り-順流・逆流-のidを付与"}},[t._v("#")]),t._v(" 上り下り(順流・逆流)のIDを付与")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 新規DF(順流)")]),t._v("\ngdf3_0 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" gdf2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("copy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ngdf3_0 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" gdf3_0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"osm_id"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"code"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fclass"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"geometry"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 始点の緯度経度")]),t._v("\ngdf3_0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"init_lon"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" init_lon\ngdf3_0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"init_lat"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" init_lat\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 終点の緯度経度")]),t._v("\ngdf3_0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"term_lon"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" term_lon\ngdf3_0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"term_lat"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" term_lat\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 交通流の方向")]),t._v("\ngdf3_0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vec"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0"')]),t._v("\n")])])]),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 新規DF(逆流)")]),t._v("\ngdf3_1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" gdf2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("copy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ngdf3_1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" gdf3_1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"osm_id"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"code"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fclass"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"geometry"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 始点の緯度経度")]),t._v("\ngdf3_1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"init_lon"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" term_lon\ngdf3_1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"init_lat"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" term_lat\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 終点の緯度経度")]),t._v("\ngdf3_1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"term_lon"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" init_lon\ngdf3_1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"term_lat"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" init_lat\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 交通流の方向")]),t._v("\ngdf3_1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vec"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),t._v("\n")])])]),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 縦に結合")]),t._v("\ngdf3 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("concat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("gdf3_0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" gdf3_1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" axis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h3",{attrs:{id:"始点終点ノードにidを付与"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#始点終点ノードにidを付与"}},[t._v("#")]),t._v(" 始点終点ノードにIDを付与")]),t._v(" "),a("p",[t._v("緯度経度からMD5ハッシュ値に変換して、座標を統一する")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# # 始点のノードID(MD5ハッシュ値)")]),t._v("\ndat "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" gdf3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"init_lon"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("astype"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("str")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("gdf3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"init_lat"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("astype"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("str")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ngdf3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"init_node"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" dat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("apply")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("lambda")]),t._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" hashlib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("md5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("encode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hexdigest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 終点ノードのノードID(MD5ハッシュ値)")]),t._v("\ndat "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" gdf3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"term_lon"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("astype"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("str")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("gdf3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"term_lat"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("astype"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("str")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ngdf3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"term_node"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" dat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("apply")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("lambda")]),t._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" hashlib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("md5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("encode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hexdigest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 確認")]),t._v("\ngdf3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("head"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("table",[a("thead",[a("tr",[a("th",[t._v("osm_id")]),t._v(" "),a("th",[t._v("code")]),t._v(" "),a("th",[t._v("fclass")]),t._v(" "),a("th",[t._v("name")]),t._v(" "),a("th",[t._v("geometry")]),t._v(" "),a("th",[t._v("init_lon")]),t._v(" "),a("th",[t._v("init_lat")]),t._v(" "),a("th",[t._v("term_lon")]),t._v(" "),a("th",[t._v("term_lat")]),t._v(" "),a("th",[t._v("vec")]),t._v(" "),a("th",[t._v("init_node")]),t._v(" "),a("th",[t._v("term_node")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("20264905")]),t._v(" "),a("td",[t._v("5111")]),t._v(" "),a("td",[t._v("motorway")]),t._v(" "),a("td",[t._v("東北自動車道")]),t._v(" "),a("td",[t._v("LINESTRING (141.09415 38.80402, 141.09454 38.8...")]),t._v(" "),a("td",[t._v("141.0941549")]),t._v(" "),a("td",[t._v("38.8040228")]),t._v(" "),a("td",[t._v("141.0989473")]),t._v(" "),a("td",[t._v("38.8378983")]),t._v(" "),a("td",[t._v("0")]),t._v(" "),a("td",[t._v("8240949eec7aa3e5b5a8e1f51360a602")]),t._v(" "),a("td",[t._v("91299405649127a0303c3ef39b5974db")])]),t._v(" "),a("tr",[a("td",[t._v("22787759")]),t._v(" "),a("td",[t._v("5113")]),t._v(" "),a("td",[t._v("primary")]),t._v(" "),a("td",[t._v("県道22号仙台泉線（勾当台通り）")]),t._v(" "),a("td",[t._v("LINESTRING (140.86904 38.27224, 140.86906 38.2...")]),t._v(" "),a("td",[t._v("140.8690382")]),t._v(" "),a("td",[t._v("38.2722395")]),t._v(" "),a("td",[t._v("140.8700114")]),t._v(" "),a("td",[t._v("38.2688936")]),t._v(" "),a("td",[t._v("0")]),t._v(" "),a("td",[t._v("fa83c41314133d91cda8a3baa10ec944")]),t._v(" "),a("td",[t._v("06996e1cc8fbea04d0036bdbed2fca3b")])])])]),t._v(" "),a("h2",{attrs:{id:"csvの出力"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#csvの出力"}},[t._v("#")]),t._v(" CSVの出力")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# csvで保存")]),t._v("\ngdf3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("to_csv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./data/sample_network.csv"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" index"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h2",{attrs:{id:"qgisで投影"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#qgisで投影"}},[t._v("#")]),t._v(" QGISで投影")]),t._v(" "),a("p",[t._v("福島県四ツ倉駅周辺において、OpenStreetMapを投影した画像とGoogleMapの画像を下記に示す。")]),t._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"/image/yotukura_osm01.png",loading:"lazy"}})]),t._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"/image/yotukura_gmap.png",loading:"lazy"}})]),t._v(" "),a("p",[t._v("上画像のように、OpenStreetMapでは平面交差していても分割しないリンクが存在する。")]),t._v(" "),a("p",[t._v("次記事では、上記のリンクへの対応(足掻き)について、記述する。")]),t._v(" "),a("h2",{attrs:{id:"まとめ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#まとめ"}},[t._v("#")]),t._v(" まとめ")]),t._v(" "),a("p",[t._v("OpenStreetMapから東北地方の道路データを整理しました。")]),t._v(" "),a("p",[t._v("次記事では、平面交差していても分割しないリンクへの対応(足掻き)について、記述する。")]),t._v(" "),a("h2",{attrs:{id:"参考サイト"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考サイト"}},[t._v("#")]),t._v(" 参考サイト")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://qiita.com/c60evaporator/items/ac6a6d66a20520f129e6",target:"_blank",rel:"noopener noreferrer"}},[t._v("【PythonでGIS】GeoPandasまとめ"),a("OutboundLink")],1),a("br"),t._v(" "),a("a",{attrs:{href:"https://lonlat.info/kepler-jupyternotebook/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Kepler.glをJupyterNotebook上で扱ってみた"),a("OutboundLink")],1),a("br"),t._v(" "),a("a",{attrs:{href:"https://h-memo.com/python-geopy-distance/",target:"_blank",rel:"noopener noreferrer"}},[t._v("緯度経度から距離を算出するPythonのライブラリ ― GeoPy"),a("OutboundLink")],1),a("br"),t._v(" "),a("a",{attrs:{href:"https://www.simpletraveler.jp/2020/04/16/python-programming-hash/",target:"_blank",rel:"noopener noreferrer"}},[t._v("【Pythonプログラミング】データのハッシュ化と実行速度検証"),a("OutboundLink")],1)]),t._v(" "),a("ClientOnly",[a("CallInArticleAdsense")],1),t._v(" "),a("p",[a("a",{attrs:{href:"//af.moshimo.com/af/c/click?a_id=2604050&p_id=1555&pc_id=2816&pl_id=29835&guid=ON",rel:"nofollow",referrerpolicy:"no-referrer-when-downgrade"}},[a("img",{staticStyle:{border:"none"},attrs:{src:"//image.moshimo.com/af-img/0866/000000029835.jpg",width:"728",height:"90"}})]),a("img",{staticStyle:{border:"none"},attrs:{src:"//i.moshimo.com/af/i/impression?a_id=2604050&p_id=1555&pc_id=2816&pl_id=29835",width:"1",height:"1"}})]),t._v(" "),a("p",[a("a",{attrs:{href:"//af.moshimo.com/af/c/click?a_id=2641145&p_id=1770&pc_id=3386&pl_id=25847&guid=ON",rel:"nofollow",referrerpolicy:"no-referrer-when-downgrade"}},[a("img",{staticStyle:{border:"none"},attrs:{src:"//image.moshimo.com/af-img/1115/000000025847.png",width:"728",height:"90"}})]),a("img",{staticStyle:{border:"none"},attrs:{src:"//i.moshimo.com/af/i/impression?a_id=2641145&p_id=1770&pc_id=3386&pl_id=25847",width:"1",height:"1"}})])],1)}),[],!1,null,null,null);s.default=r.exports}}]);