(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{473:function(t,a,s){"use strict";s.r(a);var n=s(2),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("BigQueryで2拠点間の距離を算出します")]),t._v(" "),s("ClientOnly",[s("CallInArticleAdsense")],1),t._v(" "),s("p"),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#ライブラリのインストール"}},[t._v("ライブラリのインストール")])]),s("li",[s("a",{attrs:{href:"#テーブルの作成"}},[t._v("テーブルの作成")]),s("ul",[s("li",[s("a",{attrs:{href:"#データフレームの作成"}},[t._v("データフレームの作成")])]),s("li",[s("a",{attrs:{href:"#bigqueryと接続"}},[t._v("BigQueryと接続")])]),s("li",[s("a",{attrs:{href:"#データセットの生成¶"}},[t._v("データセットの生成¶")])]),s("li",[s("a",{attrs:{href:"#テーブルの作成"}},[t._v("テーブルの作成")])]),s("li",[s("a",{attrs:{href:"#pandasからデータを投入"}},[t._v("pandasからデータを投入")])]),s("li",[s("a",{attrs:{href:"#テーブルの確認"}},[t._v("テーブルの確認")])])])]),s("li",[s("a",{attrs:{href:"#bigqueryで各拠点間の組み合わせを作成"}},[t._v("BigQueryで各拠点間の組み合わせを作成")])]),s("li",[s("a",{attrs:{href:"#bigqueryで2拠点間距離を算出"}},[t._v("BigQueryで2拠点間距離を算出")])]),s("li",[s("a",{attrs:{href:"#参考サイト"}},[t._v("参考サイト")])])])]),s("p"),t._v(" "),s("h2",{attrs:{id:"ライブラリのインストール"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ライブラリのインストール"}},[t._v("#")]),t._v(" ライブラリのインストール")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("!pip install "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("upgrade pandas"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("gbq "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'google-cloud-bigquery[bqstorage,pandas]'")]),t._v("\n")])])]),s("h2",{attrs:{id:"テーブルの作成"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#テーブルの作成"}},[t._v("#")]),t._v(" テーブルの作成")]),t._v(" "),s("h3",{attrs:{id:"データフレームの作成"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#データフレームの作成"}},[t._v("#")]),t._v(" データフレームの作成")]),t._v(" "),s("p",[t._v("仮のデータを作成します。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" pandas "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" pd\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# データフレームの作成")]),t._v("\ndf "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DataFrame"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'仙台駅'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("38.26063926000281")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("140.8822763620918")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'青葉城'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("38.252377384994105")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("140.85612549176253")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'榴岡公園'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("38.26066273495602")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("140.89707530354525")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ラーメン二郎仙台店'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("38.26181864469619")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("140.8662996759938")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                  columns"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'name'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'lat'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'lon'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ndisplay"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("df"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"bigqueryと接続"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#bigqueryと接続"}},[t._v("#")]),t._v(" BigQueryと接続")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" google"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cloud "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" bigquery\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# keyとなるjsonファイルを読み込み")]),t._v("\nKEY_PATH "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'****.json'")]),t._v("\n\nbq_client "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" bigquery"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("from_service_account_json"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("KEY_PATH"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"データセットの生成¶"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#データセットの生成¶"}},[t._v("#")]),t._v(" データセットの生成¶")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# データセットの生成")]),t._v("\ndataset_id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sample_data'")]),t._v("\nbq_client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("create_dataset"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dataset_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" ds "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" bq_client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("list_datasets"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dataset_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"テーブルの作成-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#テーブルの作成-2"}},[t._v("#")]),t._v(" テーブルの作成")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# データ型の確認")]),t._v("\ndf_columns "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" df"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dtypes\ndf_columns "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DataFrame"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("df_columns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("reset_index"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndf_columns "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" df_columns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rename"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("columns"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'index'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'columns'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'type'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# スキーマ")]),t._v("\nschema "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("range")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("len")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("df_columns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    column "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" df_columns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'columns'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    dtype "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("str")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("df_columns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'type'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("replace"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'datetime64[ns]'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DATETIME'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\\\n                                      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("replace"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'int64'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'INTEGER'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\\\n                                      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("replace"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'object'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'STRING'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    schema"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("append"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bigquery"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SchemaField"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dtype"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mode"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NULLABLE"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# table_idを生成（形式 : project_name.dataset_id.table_name）")]),t._v("\ndataset "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" bq_client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_dataset"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dataset_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntable_id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%s.%s.spot_table'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dataset"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("project"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dataset"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dataset_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# テーブル生成")]),t._v("\ntable "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" bigquery"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Table"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("table_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" schema"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("schema"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nbq_client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("create_table"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("table"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"pandasからデータを投入"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pandasからデータを投入"}},[t._v("#")]),t._v(" pandasからデータを投入")]),t._v(" "),s("p",[t._v("pandasのDataFrameからそのままデータを投入する")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Tableを取得")]),t._v("\ntable "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" bigquery"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Table"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("table_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" schema"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("schema"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# DataFrameを投入")]),t._v("\nbq_client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("insert_rows_from_dataframe"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("table"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" df"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"テーブルの確認"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#テーブルの確認"}},[t._v("#")]),t._v(" テーブルの確認")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" pandas "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" pd\n\nquery "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("f'''SELECT * \n            FROM ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("table_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'''")])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# strベースのクエリと、project_idが必要")]),t._v("\ndf_gbq "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read_gbq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" table_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("split"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"."')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndisplay"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("df_gbq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("table",[s("thead",[s("tr",[s("th",[t._v("name")]),t._v(" "),s("th",[t._v("lat")]),t._v(" "),s("th",[t._v("lon")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("仙台駅")]),t._v(" "),s("td",[t._v("38.260639")]),t._v(" "),s("td",[t._v("140.882276")])]),t._v(" "),s("tr",[s("td",[t._v("青葉城")]),t._v(" "),s("td",[t._v("38.252377")]),t._v(" "),s("td",[t._v("140.856125")])]),t._v(" "),s("tr",[s("td",[t._v("榴岡公園")]),t._v(" "),s("td",[t._v("38.260663")]),t._v(" "),s("td",[t._v("140.897075")])]),t._v(" "),s("tr",[s("td",[t._v("ラーメン二郎仙台店")]),t._v(" "),s("td",[t._v("38.261819")]),t._v(" "),s("td",[t._v("140.866300")])])])]),t._v(" "),s("h2",{attrs:{id:"bigqueryで各拠点間の組み合わせを作成"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#bigqueryで各拠点間の組み合わせを作成"}},[t._v("#")]),t._v(" BigQueryで各拠点間の組み合わせを作成")]),t._v(" "),s("p",[t._v("「CROSS JOIN」より、BigQueryで各拠点間の組み合わせを作成します。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" pandas "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" pd\n\nquery "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("f'''\n        WITH t1 AS (\n            SELECT\n            t0.name AS o_name, t0.lat AS o_lat, t0.lon AS o_lon\n            FROM \n                ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("table_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(" AS t0 \n        ),\n        t2 AS (\n            SELECT\n            t0.name AS d_name, t0.lat AS d_lat, t0.lon AS d_lon\n            FROM \n                ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("table_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(" AS t0 \n        )\n        SELECT\n            *\n        FROM \n            t1 \n        CROSS JOIN t2'''")])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# strベースのクエリと、project_idが必要")]),t._v("\ndf_gbq "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read_gbq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" table_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("split"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"."')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndisplay"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("df_gbq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("table",[s("thead",[s("tr",[s("th",[t._v("o_name")]),t._v(" "),s("th",[t._v("o_lat")]),t._v(" "),s("th",[t._v("o_lon")]),t._v(" "),s("th",[t._v("d_name")]),t._v(" "),s("th",[t._v("d_lat")]),t._v(" "),s("th",[t._v("d_lon")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("榴岡公園")]),t._v(" "),s("td",[t._v("38.260663")]),t._v(" "),s("td",[t._v("140.897075")]),t._v(" "),s("td",[t._v("榴岡公園")]),t._v(" "),s("td",[t._v("38.260663")]),t._v(" "),s("td",[t._v("140.897075")])]),t._v(" "),s("tr",[s("td",[t._v("榴岡公園")]),t._v(" "),s("td",[t._v("38.260663")]),t._v(" "),s("td",[t._v("140.897075")]),t._v(" "),s("td",[t._v("仙台駅")]),t._v(" "),s("td",[t._v("38.260639")]),t._v(" "),s("td",[t._v("140.882276")])]),t._v(" "),s("tr",[s("td",[t._v("榴岡公園")]),t._v(" "),s("td",[t._v("38.260663")]),t._v(" "),s("td",[t._v("140.897075")]),t._v(" "),s("td",[t._v("ラーメン二郎仙台店")]),t._v(" "),s("td",[t._v("38.261819")]),t._v(" "),s("td",[t._v("140.866300")])]),t._v(" "),s("tr",[s("td",[t._v("榴岡公園")]),t._v(" "),s("td",[t._v("38.260663")]),t._v(" "),s("td",[t._v("140.897075")]),t._v(" "),s("td",[t._v("青葉城")]),t._v(" "),s("td",[t._v("38.252377")]),t._v(" "),s("td",[t._v("140.856125")])])])]),t._v(" "),s("h2",{attrs:{id:"bigqueryで2拠点間距離を算出"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#bigqueryで2拠点間距離を算出"}},[t._v("#")]),t._v(" BigQueryで2拠点間距離を算出")]),t._v(" "),s("p",[t._v("「st_distance」より、BigQueryで2拠点間距離(m)を算出します。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" pandas "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" pd\n\nquery "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("f'''\n        WITH t1 AS (\n            SELECT\n            t0.name AS o_name, t0.lat AS o_lat, t0.lon AS o_lon\n            FROM \n                ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("table_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(" AS t0 \n        ),\n        t2 AS (\n            SELECT\n            t0.name AS d_name, t0.lat AS d_lat, t0.lon AS d_lon\n            FROM \n                ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("table_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(" AS t0 \n        )\n        SELECT\n            *, \n            st_distance(\n                st_geogpoint(o_lon, o_lat),\n                st_geogpoint(d_lon, d_lat)\n            ) as distance\n        FROM (\n            SELECT\n                *\n            FROM \n                t1 \n            CROSS JOIN t2)'''")])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# strベースのクエリと、project_idが必要")]),t._v("\ndf_gbq "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read_gbq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" table_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("split"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"."')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndisplay"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("df_gbq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("table",[s("thead",[s("tr",[s("th",[t._v("o_name")]),t._v(" "),s("th",[t._v("o_lat")]),t._v(" "),s("th",[t._v("o_lon")]),t._v(" "),s("th",[t._v("d_name")]),t._v(" "),s("th",[t._v("d_lat")]),t._v(" "),s("th",[t._v("d_lon")]),t._v(" "),s("th",[t._v("distance")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("ラーメン二郎仙台店")]),t._v(" "),s("td",[t._v("38.261819")]),t._v(" "),s("td",[t._v("140.866300")]),t._v(" "),s("td",[t._v("ラーメン二郎仙台店")]),t._v(" "),s("td",[t._v("38.261819")]),t._v(" "),s("td",[t._v("140.866300")]),t._v(" "),s("td",[t._v("0.000000")])]),t._v(" "),s("tr",[s("td",[t._v("ラーメン二郎仙台店")]),t._v(" "),s("td",[t._v("38.261819")]),t._v(" "),s("td",[t._v("140.866300")]),t._v(" "),s("td",[t._v("青葉城")]),t._v(" "),s("td",[t._v("38.252377")]),t._v(" "),s("td",[t._v("140.856125")]),t._v(" "),s("td",[t._v("1375.247245")])]),t._v(" "),s("tr",[s("td",[t._v("ラーメン二郎仙台店")]),t._v(" "),s("td",[t._v("38.261819")]),t._v(" "),s("td",[t._v("140.866300")]),t._v(" "),s("td",[t._v("仙台駅")]),t._v(" "),s("td",[t._v("38.260639")]),t._v(" "),s("td",[t._v("140.882276")]),t._v(" "),s("td",[t._v("1401.073901")])]),t._v(" "),s("tr",[s("td",[t._v("ラーメン二郎仙台店")]),t._v(" "),s("td",[t._v("38.261819")]),t._v(" "),s("td",[t._v("140.866300")]),t._v(" "),s("td",[t._v("榴岡公園")]),t._v(" "),s("td",[t._v("38.260663")]),t._v(" "),s("td",[t._v("140.897075")]),t._v(" "),s("td",[t._v("2690.088942")])])])]),t._v(" "),s("h2",{attrs:{id:"参考サイト"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考サイト"}},[t._v("#")]),t._v(" 参考サイト")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://qiita.com/shouta-dev/items/f7797665e325da35daf1",target:"_blank",rel:"noopener noreferrer"}},[t._v("BigQueryで２点間の距離を計算する"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://cloud.google.com/bigquery/docs/reference/standard-sql/query-syntax?hl=ja",target:"_blank",rel:"noopener noreferrer"}},[t._v("BigQuery クエリ構文"),s("OutboundLink")],1)]),t._v(" "),s("ClientOnly",[s("CallInArticleAdsense")],1),t._v(" "),s("p",[s("a",{attrs:{href:"//af.moshimo.com/af/c/click?a_id=2604050&p_id=1555&pc_id=2816&pl_id=29835&guid=ON",rel:"nofollow",referrerpolicy:"no-referrer-when-downgrade"}},[s("img",{staticStyle:{border:"none"},attrs:{src:"//image.moshimo.com/af-img/0866/000000029835.jpg",width:"728",height:"90"}})]),s("img",{staticStyle:{border:"none"},attrs:{src:"//i.moshimo.com/af/i/impression?a_id=2604050&p_id=1555&pc_id=2816&pl_id=29835",width:"1",height:"1"}})]),t._v(" "),s("p",[s("a",{attrs:{href:"//af.moshimo.com/af/c/click?a_id=2641145&p_id=1770&pc_id=3386&pl_id=25847&guid=ON",rel:"nofollow",referrerpolicy:"no-referrer-when-downgrade"}},[s("img",{staticStyle:{border:"none"},attrs:{src:"//image.moshimo.com/af-img/1115/000000025847.png",width:"728",height:"90"}})]),s("img",{staticStyle:{border:"none"},attrs:{src:"//i.moshimo.com/af/i/impression?a_id=2641145&p_id=1770&pc_id=3386&pl_id=25847",width:"1",height:"1"}})])],1)}),[],!1,null,null,null);a.default=e.exports}}]);