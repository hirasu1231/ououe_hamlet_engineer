(window.webpackJsonp=window.webpackJsonp||[]).push([[71],{382:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("COCOデータセットから特定のクラスの画像を抽出し，アノテーション情報を整形したので，keras-yolo4での転移学習を実施します．")]),t._v(" "),a("ClientOnly",[a("CallInArticleAdsense")],1),t._v(" "),a("p",[t._v("今回はGoogle ColabとGoogle Driveを連携させて，notebook形式で実行してます．"),a("br")]),t._v(" "),a("blockquote",[a("p",[t._v("Google Colaboratory（以下Google Colab）は、Google社が無料で提供している機械学習の教育や研究用の開発環境です。開発環境はJupyter Notebookに似たインターフェースを持ち、Pythonの主要なライブラリがプリインストールされています。"),a("br"),t._v("\n引用元："),a("a",{attrs:{href:"https://interface.cqpub.co.jp/ail01/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Google Colabの使い方"),a("OutboundLink")],1)])]),t._v(" "),a("p",[t._v("最終的に，Youtubeの"),a("a",{attrs:{href:"https://www.youtube.com/watch?v=wnRH3-CIk4I",target:"_blank",rel:"noopener noreferrer"}},[t._v("平成24年 元旦配達出発式"),a("OutboundLink")],1),t._v("のIDを振り分けるトラッキングも含めたバイクのカウントを実施します．")]),t._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#google-colabのファイル構成"}},[t._v("Google Colabのファイル構成")])]),a("li",[a("a",{attrs:{href:"#転移学習"}},[t._v("転移学習")])]),a("li",[a("a",{attrs:{href:"#keras-yolo4"}},[t._v("keras-yolo4")]),a("ul",[a("li",[a("a",{attrs:{href:"#keras-yolo4のダウンロード"}},[t._v("keras-yolo4のダウンロード")])])])]),a("li",[a("a",{attrs:{href:"#keras-yolo4の起動チェック"}},[t._v("keras-yolo4の起動チェック")]),a("ul",[a("li",[a("a",{attrs:{href:"#初期重みのダウンロード"}},[t._v("初期重みのダウンロード")])]),a("li",[a("a",{attrs:{href:"#モジュールのインストール"}},[t._v("モジュールのインストール")])]),a("li",[a("a",{attrs:{href:"#重みの変換"}},[t._v("重みの変換")])]),a("li",[a("a",{attrs:{href:"#テストの実行"}},[t._v("テストの実行")])])])]),a("li",[a("a",{attrs:{href:"#keras-yolo4での学習"}},[t._v("keras-yolo4での学習")]),a("ul",[a("li",[a("a",{attrs:{href:"#学習データのアップロード"}},[t._v("学習データのアップロード")])]),a("li",[a("a",{attrs:{href:"#学習の実行"}},[t._v("学習の実行")])])])]),a("li",[a("a",{attrs:{href:"#バイク検出の実行"}},[t._v("バイク検出の実行")])]),a("li",[a("a",{attrs:{href:"#まとめ"}},[t._v("まとめ")])]),a("li",[a("a",{attrs:{href:"#参考サイト"}},[t._v("参考サイト")])])])]),a("p"),t._v(" "),a("p",[a("a",{attrs:{href:"//af.moshimo.com/af/c/click?a_id=2604050&p_id=1555&pc_id=2816&pl_id=29835&guid=ON",rel:"nofollow",referrerpolicy:"no-referrer-when-downgrade"}},[a("img",{staticStyle:{border:"none"},attrs:{src:"//image.moshimo.com/af-img/0866/000000029835.jpg",width:"728",height:"90"}})]),a("img",{staticStyle:{border:"none"},attrs:{src:"//i.moshimo.com/af/i/impression?a_id=2604050&p_id=1555&pc_id=2816&pl_id=29835",width:"1",height:"1"}})]),t._v(" "),a("p",[a("a",{attrs:{href:"//af.moshimo.com/af/c/click?a_id=2641145&p_id=1770&pc_id=3386&pl_id=25847&guid=ON",rel:"nofollow",referrerpolicy:"no-referrer-when-downgrade"}},[a("img",{staticStyle:{border:"none"},attrs:{src:"//image.moshimo.com/af-img/1115/000000025847.png",width:"728",height:"90"}})]),a("img",{staticStyle:{border:"none"},attrs:{src:"//i.moshimo.com/af/i/impression?a_id=2641145&p_id=1770&pc_id=3386&pl_id=25847",width:"1",height:"1"}})]),t._v(" "),a("h2",{attrs:{id:"google-colabのファイル構成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#google-colabのファイル構成"}},[t._v("#")]),t._v(" Google Colabのファイル構成")]),t._v(" "),a("p",[t._v("プロジェクトディレクトリはpost_bikeとしています．度々，省略しています．")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("post_bike\n├── /keras-yolo4\n│   ├── /logs <- 学習モデルの保存先\n│   │   └── /keras_bike\n│   ├── keras_bike.zip <- 学習データ解凍前\n│   ├── /keras_bike <- 学習データ\n│   ├── decode_np.py\n│   ├── test.py\n│   ├── test_video.py\n│   ├── yolov4.weights\n│   ├── yolo4_weight.h5\n│   ├── H240101_post.mp4 <- 元動画\n│   ├── keras_post.mp4 <- 検出動画\n│   └── (省略)\n└── keras-yolo4.ipynb <- 実行用ノートブック\n")])])]),a("h2",{attrs:{id:"転移学習"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#転移学習"}},[t._v("#")]),t._v(" 転移学習")]),t._v(" "),a("blockquote",[a("p",[t._v("転移学習とは、ある領域の知識を別の領域の学習に適用させる技術です。"),a("br"),t._v("\nたとえば大量の犬の画像データと少量の猫の画像データがあり、犬の種類判別モデルと猫の種類判別モデルを作成する場合、通常の機械学習では下図の左側のように犬と猫別々でモデルを作成します。しかしこのとき、猫の画像は少ないので猫の種類判別モデルは判別精度が低い可能性があります。そこで下図の右側のように、犬の種類判別の課題から得られた知識を猫の種類判別モデルに適応させる転移学習を行うことで、判別精度の向上を図ることができます。"),a("br"),t._v("\n引用元:"),a("a",{attrs:{href:"https://ledge.ai/transfer-learning/#:~:text=%E8%BB%A2%E7%A7%BB%E5%AD%A6%E7%BF%92%E3%81%A8%E3%81%AF%E3%80%81%E3%81%82%E3%82%8B,%E3%81%AB%E9%81%A9%E7%94%A8%E3%81%95%E3%81%9B%E3%82%8B%E6%8A%80%E8%A1%93%E3%81%A7%E3%81%99%E3%80%82",target:"_blank",rel:"noopener noreferrer"}},[t._v("転移学習とは | メリット・デメリット・ファインチューニングの意味"),a("OutboundLink")],1)])]),t._v(" "),a("p",[t._v("本稿では，出力される1つ前の層(Yolov4では3つある)までを固定して，残りを学習させています．")]),t._v(" "),a("h2",{attrs:{id:"keras-yolo4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#keras-yolo4"}},[t._v("#")]),t._v(" keras-yolo4")]),t._v(" "),a("h3",{attrs:{id:"keras-yolo4のダウンロード"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#keras-yolo4のダウンロード"}},[t._v("#")]),t._v(" keras-yolo4のダウンロード")]),t._v(" "),a("p",[t._v("Google ColabとGoogle Driveを連携させて，gitからkeras-yolo4をダウンロードします．")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Google ColabとGoogle Driveを連携")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" google"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("colab "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" drive\ndrive"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mount"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/content/drive'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("bash\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ディレクトリの移動")]),t._v("\ncd drive"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("MyDrive"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("post_bike"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# gitのダウンロード")]),t._v("\ngit clone https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("//")]),t._v("github"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Ma"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Dan"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("keras"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("yolo4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("git\n")])])]),a("h2",{attrs:{id:"keras-yolo4の起動チェック"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#keras-yolo4の起動チェック"}},[t._v("#")]),t._v(" keras-yolo4の起動チェック")]),t._v(" "),a("p",[t._v("正常に起動するか，デフォルトで入っている画像を検出させてチェックします．")]),t._v(" "),a("h3",{attrs:{id:"初期重みのダウンロード"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#初期重みのダウンロード"}},[t._v("#")]),t._v(" 初期重みのダウンロード")]),t._v(" "),a("p",[t._v("今回は起動するかチェックするために，YOLOv4学習済みのパラメータをダウンロードします．")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ディレクトリの移動")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("cd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("content"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("drive"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("MyDrive"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("post_bike"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("keras"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("yolo4"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 初期重みをダウンロード")]),t._v("\n!wget https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("//")]),t._v("github"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("AlexeyAB"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("darknet"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("releases"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("download"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("darknet_yolo_v3_optimal"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("yolov4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("weights\n")])])]),a("h3",{attrs:{id:"モジュールのインストール"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#モジュールのインストール"}},[t._v("#")]),t._v(" モジュールのインストール")]),t._v(" "),a("p",[t._v("keras-yolo4に応じて，モジュールをインストールします．")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("!pip install keras"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.2")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),t._v("\n!pip install tensorflow"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.15")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),t._v("\n!pip install tensorflow"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("gpu"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.15")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),t._v("\n!pip install keras"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("applications"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".7")]),t._v("\n")])])]),a("h3",{attrs:{id:"重みの変換"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重みの変換"}},[t._v("#")]),t._v(" 重みの変換")]),t._v(" "),a("p",[t._v("darknet用の重みをkerasで使えるように変換します．(yolov4.weights -> yolo4_weight.h5)")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ディレクトリの移動")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("cd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("content"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("drive"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("MyDrive"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("post_bike"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("keras"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("yolo4"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重みの変換")]),t._v("\n!python convert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py\n")])])]),a("h3",{attrs:{id:"テストの実行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#テストの実行"}},[t._v("#")]),t._v(" テストの実行")]),t._v(" "),a("p",[t._v("GPUが認識しているかの確認後，検出が実行しkeras-yolo4が正常に起動するか確認します．")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" tensorflow "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" tf\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# GPUの起動確認")]),t._v("\ndevice_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" tf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("gpu_device_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" device_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/device:GPU:0'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GPU device not found'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Found GPU at: {}'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("device_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Found GPU at: /device:GPU:0")]),t._v("\n")])])]),a("p",[t._v("test.pyを以下の記述に変更して実行してください．")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# test.pyの36-38行目")]),t._v("\nmodel_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'yolo4_weight.h5'")]),t._v("\nanchors_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'model_data/yolo4_anchors.txt'")]),t._v("\nclasses_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'model_data/coco_classes.txt'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# test.pyの61-行目をコメントアウト")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# while True:")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#     # img = input('Input image filename:')")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#     try:")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#         image = cv2.imread(img)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#     except:")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#         print('Open Error! Try again!')")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#         continue")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#     else:")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#         image, boxes, scores, classes = _decode.detect_image(image, True)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#         cv2.imshow('image', image)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#         cv2.waitKey(0)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#         cv2.destroyAllWindows()")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# yolo4_model.close_session()")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 追記")]),t._v("\nimage "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cv2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("imread"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'person.jpg'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nimage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" boxes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" scores"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" classes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" _decode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("detect_image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ncv2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("imwrite"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'person_result.jpg'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ディレクトリの移動")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("cd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("content"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("drive"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("MyDrive"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("post_bike"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("keras"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("yolo4"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# テスト用画像のダウンロード")]),t._v("\n!wget https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("//")]),t._v("github"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("AlexeyAB"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("darknet"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("blob"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("master"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("person"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jpg?raw"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("O person"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jpg\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# テスト(person.jpg)")]),t._v("\n!python test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py\n")])])]),a("p",[t._v("person.jpgの検出結果"),a("br"),t._v(" "),a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"/image/keras_person_result.jpg",loading:"lazy"}})]),t._v(" "),a("h2",{attrs:{id:"keras-yolo4での学習"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#keras-yolo4での学習"}},[t._v("#")]),t._v(" keras-yolo4での学習")]),t._v(" "),a("p",[t._v("keras-yolo4も起動も確認できたので，keras-yolo4でバイク検出の学習を実施します．")]),t._v(" "),a("h3",{attrs:{id:"学習データのアップロード"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#学習データのアップロード"}},[t._v("#")]),t._v(" 学習データのアップロード")]),t._v(" "),a("p",[t._v("僕の経験の話になりますが，Google Colabを使う場合は，zip圧縮してからGoogle Driveにアップロードして，Google Colabのノートブック上で解凍させた方がエラーもなく早い感じがするので，ここではそのコードをあげます．")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ディレクトリの移動")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("cd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("content"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("drive"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("MyDrive"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("post_bike"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("darknet"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 学習データの解凍")]),t._v("\n!unzip darknet4_bike"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("zip")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("null\n")])])]),a("h3",{attrs:{id:"学習の実行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#学習の実行"}},[t._v("#")]),t._v(" 学習の実行")]),t._v(" "),a("p",[t._v("ダウンロードしたkeras-yolo4に移動して，train.pyの設定をイジって実行準備をします．"),a("br"),t._v("\nannotation_train_pathとannotation_val_pathは学習・評価用のデータ，log_dirはモデルの出力先，classes_pathはクラスのリストを示す．")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# train.py")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 26-29行目")]),t._v("\nannotation_train_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'keras_bike/train.txt'")]),t._v(" \nannotation_val_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'keras_bike/val.txt'")]),t._v(" \nlog_dir "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'logs/keras_bike/'")]),t._v("\nclasses_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'keras_bike/yolov4_bike.txt'")]),t._v("  \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 51行目")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# weights_path：重みの読み込み")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# freeze_body：固定の仕方の設定")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1:250層目の特徴量抽出層までを固定")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2:出力直前の3層前までを固定")]),t._v("\nmodel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" model_body "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" create_model"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("input_shape"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" anchors_stride_base"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" num_classes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" load_pretrained"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" freeze_body"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" weights_path"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'yolo4_weight.h5'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 58行目")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# eval_file='2012_val.txt' -> eval_file=annotation_val_path")]),t._v("\nevaluation "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Evaluate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("model_body"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("model_body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" anchors"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("anchors"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" class_names"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("class_index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" score_threshold"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.05")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tensorboard"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("logging"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" weighted_average"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" eval_file"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("annotation_val_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" log_dir"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("log_dir"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 127-128行目")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 固定する層の指定")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" freeze_body "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Freeze darknet53 body or freeze all but 3 output layers.")]),t._v("\n  num "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("250")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("len")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("model_body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("layers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("freeze_body"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("range")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("num"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" model_body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("layers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("trainable "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Freeze the first {} layers of total {} layers.'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("num"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("len")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("model_body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("layers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ディレクトリの移動")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("cd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("content"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("drive"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("MyDrive"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("post_bike"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("keras"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("yolo4"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 学習の実行")]),t._v("\n!python train"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py\n")])])]),a("h2",{attrs:{id:"バイク検出の実行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#バイク検出の実行"}},[t._v("#")]),t._v(" バイク検出の実行")]),t._v(" "),a("p",[t._v("学習(約5時間)が終わったので，出力された最終の重み"),a("code",[t._v("logs/keras_bike/ep063-loss12.063.h5")]),t._v("でtest_video.pyを作成しバイク検出を実施します．")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# test_video.py")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" os\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" colorsys\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" numpy "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" np\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" keras "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" backend "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" K\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" keras"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("models "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" load_model\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" keras"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("layers "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Input\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" yolo4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" yolo_eval"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" yolo4_body\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" yolo4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("utils "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" letterbox_image\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" PIL "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ImageFont"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ImageDraw\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" timeit "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" default_timer "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" timer\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" cv2\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" decode_np "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Decode\n\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("classes_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    classes_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("expanduser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("classes_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("classes_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" f"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        class_names "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" f"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("readlines"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    class_names "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("strip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" c "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" class_names"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" class_names\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_anchors")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("anchors_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    anchors_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("expanduser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("anchors_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("anchors_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" f"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        anchors "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" f"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("readline"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    anchors "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("float")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" x "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" anchors"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("split"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("','")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" np"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("anchors"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("reshape"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" __name__ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'__main__'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Please visit https://github.com/miemie2013/Keras-YOLOv4 for more complete model!'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    model_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'logs/keras_bike/ep063-loss12.063.h5'")]),t._v("\n    anchors_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'model_data/yolo4_anchors.txt'")]),t._v("\n    classes_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'keras_bike/yolov4_bike.txt'")]),t._v("\n\n    class_names "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" get_class"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("classes_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    anchors "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" get_anchors"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("anchors_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    num_anchors "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("len")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("anchors"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    num_classes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("len")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("class_names"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    model_image_size "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("608")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("608")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 分数阈值和nms_iou阈值")]),t._v("\n    conf_thresh "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.2")]),t._v("\n    nms_thresh "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.45")]),t._v("\n\n    yolo4_model "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" yolo4_body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Input"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("shape"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("model_image_size"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" num_anchors"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("//")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" num_classes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    model_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("expanduser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("model_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),t._v(" model_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("endswith"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.h5'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Keras model or weights must be a .h5 file.'")]),t._v("\n\n    yolo4_model"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("load_weights"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("model_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    _decode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Decode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("conf_thresh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nms_thresh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" model_image_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" yolo4_model"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" class_names"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 入力動画")]),t._v("\n    input_video "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'H240101_post.mp4'")]),t._v("\n    output_video "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'keras_post.mp4'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 出力動画")]),t._v("\n    vid "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cv2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("VideoCapture"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("input_video"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    codec "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cv2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("VideoWriter_fourcc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'XVID'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    vid_fps "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("round")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cv2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CAP_PROP_FPS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    vid_width"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("vid_height "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cv2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CAP_PROP_FRAME_WIDTH"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cv2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CAP_PROP_FRAME_HEIGHT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    out "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cv2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("VideoWriter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("output_video"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" codec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vid_fps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vid_width"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vid_height"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        _"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" img "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" img "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("is")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Completed'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 高さと幅")]),t._v("\n        height"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" width"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" img"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shape\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 検出")]),t._v("\n        img_out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" boxes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" scores"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" classes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" _decode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("detect_image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("img"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 出力動画に書き込み")]),t._v("\n        out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("write"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("img_out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        \n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" cv2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("waitKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("ord")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'q'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),t._v("\n    \nvid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("release"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("release"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("以下のコードをGoogle Colabで実行します．")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ディレクトリの移動")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("cd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("content"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("drive"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("MyDrive"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("post_bike"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("keras"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("yolo4"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 学習の実行")]),t._v("\n!python test_video"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py\n")])])]),a("p",[t._v("keras-yolo4の検出結果"),a("br"),t._v(" "),a("img",{staticClass:"lazy",attrs:{alt:"keras-yolo4の検出結果","data-src":"/image/keras_post_md.gif",loading:"lazy"}})]),t._v(" "),a("h2",{attrs:{id:"まとめ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#まとめ"}},[t._v("#")]),t._v(" まとめ")]),t._v(" "),a("p",[t._v("keras-yolo4でのバイク検出の転移学習を実施しましました．"),a("br"),t._v("\n結構検出できていたので，次は，DEEPSORTによるトラッキング」・「FastMOTによるトラッキング」・「EfficientDet」を実施します．")]),t._v(" "),a("h2",{attrs:{id:"参考サイト"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考サイト"}},[t._v("#")]),t._v(" 参考サイト")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/Ma-Dan/keras-yolo4",target:"_blank",rel:"noopener noreferrer"}},[t._v("Ma-Dan/keras-yolo4"),a("OutboundLink")],1),a("br"),t._v(" "),a("a",{attrs:{href:"https://ameblo.jp/sijukara-tama/entry-12641048746.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Keras版 YOLOv4を動かしてみる。"),a("OutboundLink")],1),a("br"),t._v(" "),a("a",{attrs:{href:"https://nixeneko.hatenablog.com/entry/2018/08/15/000000",target:"_blank",rel:"noopener noreferrer"}},[t._v("Windows 10上のDarknetでYolo v3をトレーニングしOpenCVから使ってみる"),a("OutboundLink")],1),a("br"),t._v(" "),a("a",{attrs:{href:"https://note.nkmk.me/python-opencv-imread-imwrite/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Python, OpenCVで画像ファイルの読み込み、保存（imread, imwrite）"),a("OutboundLink")],1),a("br"),t._v(" "),a("a",{attrs:{href:"https://note.nkmk.me/python-opencv-draw-function/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Python, OpenCVで図形描画（線、長方形、円、矢印、文字など）"),a("OutboundLink")],1),a("br"),t._v(" "),a("a",{attrs:{href:"https://qiita.com/wMETAw/items/fdb754022aec1da88e6e",target:"_blank",rel:"noopener noreferrer"}},[t._v("FFmpegで動画をGIFに変換"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"//af.moshimo.com/af/c/click?a_id=2604050&p_id=1555&pc_id=2816&pl_id=29835&guid=ON",rel:"nofollow",referrerpolicy:"no-referrer-when-downgrade"}},[a("img",{staticStyle:{border:"none"},attrs:{src:"//image.moshimo.com/af-img/0866/000000029835.jpg",width:"728",height:"90"}})]),a("img",{staticStyle:{border:"none"},attrs:{src:"//i.moshimo.com/af/i/impression?a_id=2604050&p_id=1555&pc_id=2816&pl_id=29835",width:"1",height:"1"}})]),t._v(" "),a("p",[a("a",{attrs:{href:"//af.moshimo.com/af/c/click?a_id=2641145&p_id=1770&pc_id=3386&pl_id=25847&guid=ON",rel:"nofollow",referrerpolicy:"no-referrer-when-downgrade"}},[a("img",{staticStyle:{border:"none"},attrs:{src:"//image.moshimo.com/af-img/1115/000000025847.png",width:"728",height:"90"}})]),a("img",{staticStyle:{border:"none"},attrs:{src:"//i.moshimo.com/af/i/impression?a_id=2641145&p_id=1770&pc_id=3386&pl_id=25847",width:"1",height:"1"}})]),t._v(" "),a("ClientOnly",[a("CallInArticleAdsense")],1)],1)}),[],!1,null,null,null);s.default=e.exports}}]);