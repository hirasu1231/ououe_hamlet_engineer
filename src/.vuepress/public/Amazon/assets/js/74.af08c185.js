(window.webpackJsonp=window.webpackJsonp||[]).push([[74],{376:function(t,a,s){"use strict";s.r(a);var n=s(2),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("セマンティックセグメンテーションの中で軽いモデルであるESPNetv2を実装します．"),s("br"),t._v("\n本稿ではCityscapesデータセットから人のみを抽出して，仮のオリジナルデータで学習に向けて，データ生成を実施します．"),s("br")]),t._v(" "),s("ClientOnly",[s("CallInArticleAdsense")],1),t._v(" "),s("p",[t._v("今回はGoogle ColabとGoogle Driveを連携させて，notebook形式で実行してます．"),s("br")]),t._v(" "),s("blockquote",[s("p",[t._v("Google Colaboratory（以下Google Colab）は、Google社が無料で提供している機械学習の教育や研究用の開発環境です。開発環境はJupyter Notebookに似たインターフェースを持ち、Pythonの主要なライブラリがプリインストールされています。"),s("br"),t._v("\n引用元："),s("a",{attrs:{href:"https://interface.cqpub.co.jp/ail01/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Google Colabの使い方"),s("OutboundLink")],1)])]),t._v(" "),s("p",[t._v("最終的に，人以外の背景を着色して，zoomのバーチャル背景機能のようなクロマキー合成を実装したいです．"),s("br"),t._v(" "),s("img",{staticClass:"lazy",attrs:{alt:"","data-src":"/image/zoom.jpg",loading:"lazy"}})]),t._v(" "),s("p"),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#作業ディレクトリのファイル構成"}},[t._v("作業ディレクトリのファイル構成")])]),s("li",[s("a",{attrs:{href:"#オリジナルデータの学習データセット"}},[t._v("オリジナルデータの学習データセット")])]),s("li",[s("a",{attrs:{href:"#仮オリジナルデータの生成"}},[t._v("仮オリジナルデータの生成")]),s("ul",[s("li",[s("a",{attrs:{href:"#作業ディレクトリの移動"}},[t._v("作業ディレクトリの移動")])]),s("li",[s("a",{attrs:{href:"#cityscapesデータセットの整理"}},[t._v("Cityscapesデータセットの整理")])]),s("li",[s("a",{attrs:{href:"#入力画像のリスト作成"}},[t._v("入力画像のリスト作成")])]),s("li",[s("a",{attrs:{href:"#仮オリジナルデータ生成の工程"}},[t._v("仮オリジナルデータ生成の工程")])]),s("li",[s("a",{attrs:{href:"#仮オリジナルデータ生成の実行"}},[t._v("仮オリジナルデータ生成の実行")])])])]),s("li",[s("a",{attrs:{href:"#まとめ"}},[t._v("まとめ")])]),s("li",[s("a",{attrs:{href:"#参考サイト"}},[t._v("参考サイト")])])])]),s("p"),t._v(" "),s("p",[s("a",{attrs:{href:"//af.moshimo.com/af/c/click?a_id=2604050&p_id=1555&pc_id=2816&pl_id=29835&guid=ON",rel:"nofollow",referrerpolicy:"no-referrer-when-downgrade"}},[s("img",{staticStyle:{border:"none"},attrs:{src:"//image.moshimo.com/af-img/0866/000000029835.jpg",width:"728",height:"90"}})]),s("img",{staticStyle:{border:"none"},attrs:{src:"//i.moshimo.com/af/i/impression?a_id=2604050&p_id=1555&pc_id=2816&pl_id=29835",width:"1",height:"1"}})]),t._v(" "),s("p",[s("a",{attrs:{href:"//af.moshimo.com/af/c/click?a_id=2641145&p_id=1770&pc_id=3386&pl_id=25847&guid=ON",rel:"nofollow",referrerpolicy:"no-referrer-when-downgrade"}},[s("img",{staticStyle:{border:"none"},attrs:{src:"//image.moshimo.com/af-img/1115/000000025847.png",width:"728",height:"90"}})]),s("img",{staticStyle:{border:"none"},attrs:{src:"//i.moshimo.com/af/i/impression?a_id=2641145&p_id=1770&pc_id=3386&pl_id=25847",width:"1",height:"1"}})]),t._v(" "),s("h2",{attrs:{id:"作業ディレクトリのファイル構成"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#作業ディレクトリのファイル構成"}},[t._v("#")]),t._v(" 作業ディレクトリのファイル構成")]),t._v(" "),s("p",[t._v("ここでは，作業ディレクトリのsegmentation/EdgeNets/vision_datasetsのファイル構成を以下に示します．")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("segmentation/EdgeNets/vision_datasets\n├── /cityscapes\n├── /human_city <- 仮オリジナルデータ\n│   ├── train.txt\n│   ├── val.txt\n│   ├── /images\n│   │   ├── /train\n│   │   │   └── オリジナル画像\n│   │   └── /val\n│   │       └── オリジナル画像\n│   └── /annotations\n│       ├── /train\n│       │   └── マスキング画像\n│       └── /val\n│           └── マスキング画像\n│ \n└── create_data.ipynb <- データ生成用ノートブック\n")])])]),s("h2",{attrs:{id:"オリジナルデータの学習データセット"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#オリジナルデータの学習データセット"}},[t._v("#")]),t._v(" オリジナルデータの学習データセット")]),t._v(" "),s("p",[t._v("今回はCityscapesデータセットから人だけを抽出して，仮オリジナルデータとします．"),s("br"),t._v("\nオリジナルデータでESPNetv2を学習する場合は，データセットのファイル構成は以下の通りです．"),s("br"),t._v("\nここでは，データセット名前をhuman_cityとしています．"),s("br")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("/human_city\n├── train.txt\n├── /images\n│   ├── /train\n│   │   └── オリジナル画像\n│   └── /val\n│       └── オリジナル画像\n├── val.txt\n└── /annotations\n    ├── /train\n    │   └── マスキング画像\n    └── /val\n        └── マスキング画像\n")])])]),s("p",[t._v("オリジナル画像は実際の風景画像で，マスキング画像はクラスのIDに応じたRGBでマスキングした画像です．"),s("br"),t._v("\n例として，背景はRGB=(0, 0, 0)，人のクラスIDが1とするならば人の領域はRGB=(1, 1, 1)，車のクラスIDが2とするならば車の領域はRGB=(2, 2, 2)として，マスキング画像を作成する．"),s("br"),t._v("\nRGB=(0, 0, 0)の領域とRGB=(1, 1, 1)の領域は肉眼では判別不可能なので，最初は確認のためRGB=(0, 0, 255)など目立つ色で作成して，学習用に色を置換する方が個人的にお勧めします．"),s("br")]),t._v(" "),s("p",[t._v("オリジナル画像"),s("br"),t._v(" "),s("img",{staticClass:"lazy",attrs:{alt:"","data-src":"/image/original_image.png",loading:"lazy"}}),s("br")]),t._v(" "),s("p",[t._v("人をRGB=(1, 1, 1)のマスキング画像(学習用)"),s("br"),t._v("\n※肉眼じゃわからん・・・\n"),s("img",{staticClass:"lazy",attrs:{alt:"","data-src":"/image/R1.png",loading:"lazy"}}),s("br")]),t._v(" "),s("p",[t._v("人をRGB=(255, 0, 0)のマスキング画像(確認用)"),s("br"),t._v(" "),s("img",{staticClass:"lazy",attrs:{alt:"","data-src":"/image/R255.png",loading:"lazy"}})]),t._v(" "),s("h2",{attrs:{id:"仮オリジナルデータの生成"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#仮オリジナルデータの生成"}},[t._v("#")]),t._v(" 仮オリジナルデータの生成")]),t._v(" "),s("p",[t._v("Cityscapesデータセットから人だけを抽出して，仮オリジナルデータを生成します．"),s("br"),t._v("\nCityscapesデータセットのダウンロードは，"),s("a",{attrs:{href:"https://hirasu1231.github.io/hamlet_engineer/posts/2021/03/15/segmentation01.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Python, ESPNetでCityscapesデータセットでSemantic Segmentationの学習を実施する"),s("OutboundLink")],1),t._v("を参照ください．")]),t._v(" "),s("h3",{attrs:{id:"作業ディレクトリの移動"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#作業ディレクトリの移動"}},[t._v("#")]),t._v(" 作業ディレクトリの移動")]),t._v(" "),s("p",[t._v("作業ディレクトリは，Cityscapesデータセットのダウンロードで自動で生成される/EdgeNets/vision_datasetsとしています．")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Google ColabとGoogle Driveを連携")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" google"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("colab "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" drive\ndrive"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mount"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/content/drive'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ディレクトリの移動")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("cd "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("content"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("drive"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("My\\ Drive"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("segmentation"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("EdgeNets"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("vision_datasets\n")])])]),s("h3",{attrs:{id:"cityscapesデータセットの整理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cityscapesデータセットの整理"}},[t._v("#")]),t._v(" Cityscapesデータセットの整理")]),t._v(" "),s("p",[t._v("仮オリジナルデータの生成について，Cityscapesデータセットからオリジナル画像とカラーマスキング画像を使用します．"),s("br"),t._v("\nCityscapesデータセットは，オリジナル画像とカラーマスキング画像は，以下の画像名となっています．"),s("br")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("オリジナル画像：/cityscapes/leftImg8bit/train or val/＊/＊_leftImg8bit.png\nカラーマスキング画像：/cityscapes/gtFine/train or val/＊/＊_gtFine_color.png\n")])])]),s("p",[t._v("オリジナル画像"),s("br"),t._v(" "),s("img",{staticClass:"lazy",attrs:{alt:"","data-src":"/image/original_image.png",loading:"lazy"}}),s("br")]),t._v(" "),s("p",[t._v("カラーマスキング画像"),s("br"),t._v(" "),s("img",{staticClass:"lazy",attrs:{alt:"","data-src":"/image/color_mask_image.png",loading:"lazy"}})]),t._v(" "),s("h3",{attrs:{id:"入力画像のリスト作成"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#入力画像のリスト作成"}},[t._v("#")]),t._v(" 入力画像のリスト作成")]),t._v(" "),s("p",[t._v("画像を読み込ませるために，画像パスリストのtxtファイルも作成する必要があります．(train.txt, val.txt)")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# train.txt, val.txt\n# オリジナル画像, マスキング画像\ntrain/rgb/zurich_000072_000019_leftImg8bit.png,train/label/zurich_000072_000019_gtFine_color.png\ntrain/rgb/zurich_000003_000019_leftImg8bit.png,train/label/zurich_000003_000019_gtFine_color.png\ntrain/rgb/zurich_000116_000019_leftImg8bit.png,train/label/zurich_000116_000019_gtFine_color.png\ntrain/rgb/zurich_000119_000019_leftImg8bit.png,train/label/zurich_000119_000019_gtFine_color.png\ntrain/rgb/zurich_000032_000019_leftImg8bit.png,train/label/zurich_000032_000019_gtFine_color.png\n")])])]),s("h3",{attrs:{id:"仮オリジナルデータ生成の工程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#仮オリジナルデータ生成の工程"}},[t._v("#")]),t._v(" 仮オリジナルデータ生成の工程")]),t._v(" "),s("p",[t._v("人を抽出する工程は，カラーマスキング画像の色を，人以外をBGR(0, 0, 0)，人をBGR(1, 1, 1)に置換して実施してます．"),s("br"),t._v("\nカラー画像で特定の色を置換する場合は，本サイトの「"),s("a",{attrs:{href:"https://hirasu1231.github.io/hamlet_engineer/posts/2021/03/16/color-replace.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Python, OpenCVで指定した色の抽出と別の色への置換を実装する"),s("OutboundLink")],1),t._v("」を参照ください．"),s("br"),t._v("\n以下のコードでは一通りの工程をdef文でまとめました．")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" os\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" glob\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" shutil\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" cv2\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" numpy "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" np\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 学習データセットのディレクトリの作成")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make_dataset_dir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dataset_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    os"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("makedirs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{}/images/train/'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dataset_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" exist_ok"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 訓練用オリジナル画像")]),t._v("\n    os"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("makedirs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{}/annotations/train/'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dataset_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" exist_ok"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 訓練用マスキング画像")]),t._v("\n    os"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("makedirs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{}/images/val/'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dataset_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" exist_ok"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 評価用オリジナル画像")]),t._v("\n    os"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("makedirs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{}/annotations/val/'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dataset_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" exist_ok"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 評価用マスキング画像")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# オリジナル画像をコピー")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("copy_org_image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("color_image_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dataset_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# カラーマスキング画像の名前")]),t._v("\n    color_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" os"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("basename"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("color_image_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# データのディレクトリ名(データを取得した都市名)")]),t._v("\n    city_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" color_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("split"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'_'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# オリジナル画像の名前とパス")]),t._v("\n    org_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" color_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("replace"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'_gtFine_color.png'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'_leftImg8bit.png'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    org_path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./cityscapes/leftImg8bit/{0}/{1}/{2}'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" city_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" org_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# オリジナル画像をコピー")]),t._v("\n    shutil"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("copy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("org_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./{0}/images/{1}/{2}'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dataset_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" org_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{0}/{1}'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" org_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 画像の特定の色を抽出")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("color_extract")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cv2_img"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" color1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# BGRでの色抽出")]),t._v("\n    bgrLower "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" np"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("array"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("color1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 抽出する色の下限(BGR)")]),t._v("\n    bgrUpper "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" np"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("array"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("color1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 抽出する色の上限(BGR)")]),t._v("\n    img_mask "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cv2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("inRange"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cv2_img"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" bgrLower"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" bgrUpper"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# BGRからマスクを作成")]),t._v("\n    ex_img "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cv2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bitwise_and"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cv2_img"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cv2_img"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mask"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("img_mask"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 元画像とマスクを合成")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ex_img\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 画像の特定の色を別の色に置換")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("color_replace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ex_img"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" color1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" color2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    before_color "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" color1\n    after_color "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" color2\n    ex_img"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("np"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("where"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ex_img "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" before_color"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("axis"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" after_color\n    \n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ex_img\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 学習用マスキング画像を出力")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace_masking")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cv2_img"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dataset_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" color1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" color2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 学習用マスキング画像を生成")]),t._v("\n    ex_img "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" color_extract"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cv2_img"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" color1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    mask_img "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" color_replace"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ex_img"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" color1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" color2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# グレースケール化")]),t._v("\n    mask_img_gray "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cv2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cvtColor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mask_img"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cv2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("COLOR_BGR2GRAY"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# マスキング画像の出力")]),t._v("\n    color_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" os"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("basename"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("color_image"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    mask_path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./{0}/annotations/{1}/{2}'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dataset_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" color_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    cv2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("imwrite"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mask_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mask_img_gray"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{0}/{1}'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" color_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# パスリストのtxtファイル作成")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("create_txtfile")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("txt_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" txt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" txt_flag"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 新規作成")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" txt_flag"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("txt_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mode"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'w'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" f"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            f"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("write"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("txt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 追記")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("txt_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mode"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" f"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            f"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("write"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("txt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n")])])]),s("h3",{attrs:{id:"仮オリジナルデータ生成の実行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#仮オリジナルデータ生成の実行"}},[t._v("#")]),t._v(" 仮オリジナルデータ生成の実行")]),t._v(" "),s("p",[t._v("以下のコードで仮オリジナルデータ生成を実行します．"),s("br"),t._v(" "),s("a",{attrs:{href:"https://github.com/mcordts/cityscapesScripts/blob/master/cityscapesscripts/helpers/labels.py",target:"_blank",rel:"noopener noreferrer"}},[t._v("cityscapesScripts/cityscapesscripts/helpers/labels.py"),s("OutboundLink")],1),t._v("より人のマスキングのRGBは(220, 20, 60)となります．"),s("br"),t._v("\nカラーマスキング画像を読み込んで，人のRGB=(220, 20, 60)の箇所があれば，学習用データセットとして整形するようにしています．")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" os\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" glob\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" cv2\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" numpy "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" np\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 学習データセットのディレクトリの作成")]),t._v("\ndataset_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'human_city'")]),t._v("\nmake_dataset_dir"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dataset_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Cityscapes")]),t._v("\ndata_type "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'train'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# カラーマスキング")]),t._v("\ncolor_images "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" glob"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("glob"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./cityscapes/gtFine/{}/*/*_gtFine_color.png'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 人のマスキングカラー(BGR)")]),t._v("\nhuman_color "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("220")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nlabel_color "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\ntxt_flag "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" color_image "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" color_images"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# カラーマスキング画像の読み込み")]),t._v("\n    img "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cv2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("imread"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("color_image"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 人の色があるか，判定")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("len")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("img"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("np"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("where"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("img "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" human_color"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("axis"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 学習用マスキング画像を出力")]),t._v("\n        txt_mask_path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" replace_masking"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("img"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dataset_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" human_color"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" label_color"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# オリジナル画像をコピー")]),t._v("\n        txt_org_path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" copy_org_image"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("color_image"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dataset_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# パスリストのtxtファイル作成")]),t._v("\n        txt_path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./{0}/{1}.txt'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dataset_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        txt "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{0},{1}\\n'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("txt_org_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" txt_mask_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        txt_flag "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" create_txtfile"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("txt_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" txt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" txt_flag"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"まとめ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#まとめ"}},[t._v("#")]),t._v(" まとめ")]),t._v(" "),s("p",[t._v("Cityscapesデータセットから人のみを抽出して，仮のオリジナルデータで学習に向けて，データ生成を実施しました．"),s("br"),t._v("\n次回からは本稿の仮オリジナルデータでの学習を実施します．")]),t._v(" "),s("h2",{attrs:{id:"参考サイト"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考サイト"}},[t._v("#")]),t._v(" 参考サイト")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/sacmehta/EdgeNets",target:"_blank",rel:"noopener noreferrer"}},[t._v("sacmehta/EdgeNets"),s("OutboundLink")],1),s("br"),t._v(" "),s("a",{attrs:{href:"https://github.com/sacmehta/EdgeNets/blob/master/README_Segmentation.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("sacmehta/EdgeNets/README_Segmentation.md"),s("OutboundLink")],1),t._v(" "),s("a",{attrs:{href:"https://qiita.com/tokyokuma/items/37b1370ea7c84399fbb9",target:"_blank",rel:"noopener noreferrer"}},[t._v("ESPNetで自作データセットを学習してセグメンテーション"),s("OutboundLink")],1),s("br"),t._v(" "),s("a",{attrs:{href:"https://rikoubou.hatenablog.com/entry/2019/02/21/190310",target:"_blank",rel:"noopener noreferrer"}},[t._v("【python/OpenCV】画像の特定の色を抽出する方法"),s("OutboundLink")],1),s("br"),t._v(" "),s("a",{attrs:{href:"https://qiita.com/pashango2/items/d6dda5f07109ee5b6163",target:"_blank",rel:"noopener noreferrer"}},[t._v("PIL/Pillowで画像の色を高速に置換する"),s("OutboundLink")],1),s("br"),t._v(" "),s("a",{attrs:{href:"http://ni4muraano.hatenablog.com/entry/2017/05/15/000000",target:"_blank",rel:"noopener noreferrer"}},[t._v("【OpenCV】 forループを使わずに指定した色を別の色に変更する"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"//af.moshimo.com/af/c/click?a_id=2604050&p_id=1555&pc_id=2816&pl_id=29835&guid=ON",rel:"nofollow",referrerpolicy:"no-referrer-when-downgrade"}},[s("img",{staticStyle:{border:"none"},attrs:{src:"//image.moshimo.com/af-img/0866/000000029835.jpg",width:"728",height:"90"}})]),s("img",{staticStyle:{border:"none"},attrs:{src:"//i.moshimo.com/af/i/impression?a_id=2604050&p_id=1555&pc_id=2816&pl_id=29835",width:"1",height:"1"}})]),t._v(" "),s("p",[s("a",{attrs:{href:"//af.moshimo.com/af/c/click?a_id=2641145&p_id=1770&pc_id=3386&pl_id=25847&guid=ON",rel:"nofollow",referrerpolicy:"no-referrer-when-downgrade"}},[s("img",{staticStyle:{border:"none"},attrs:{src:"//image.moshimo.com/af-img/1115/000000025847.png",width:"728",height:"90"}})]),s("img",{staticStyle:{border:"none"},attrs:{src:"//i.moshimo.com/af/i/impression?a_id=2641145&p_id=1770&pc_id=3386&pl_id=25847",width:"1",height:"1"}})]),t._v(" "),s("ClientOnly",[s("CallInArticleAdsense")],1)],1)}),[],!1,null,null,null);a.default=e.exports}}]);