(window.webpackJsonp=window.webpackJsonp||[]).push([[84],{394:function(t,e,a){"use strict";a.r(e);var s=a(2),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("Python＋Docker＋Selenium＋Chromeで甘茶の音楽工房ウェブスクレイピングします．本稿では，seleniumの操作を検索しながら必要な工程を実装します．jupyterだと楽です．"),a("br")]),t._v(" "),a("ClientOnly",[a("CallInArticleAdsense")],1),t._v(" "),a("p",[t._v("作業用BGMとして"),a("a",{attrs:{href:"https://amachamusic.chagasi.com/image_kurai.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("甘茶の音楽工房"),a("OutboundLink")],1),t._v("の音楽をダウンロードして聞いていました．いい加減面倒臭くなってきたので，ウェブスクレイピングでダウンロードしていきます．"),a("br")]),t._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#seleniumの操作"}},[t._v("Seleniumの操作")]),a("ul",[a("li",[a("a",{attrs:{href:"#モジュール"}},[t._v("モジュール")])]),a("li",[a("a",{attrs:{href:"#ページソースの表示"}},[t._v("ページソースの表示")])]),a("li",[a("a",{attrs:{href:"#ページ一覧の取得"}},[t._v("ページ一覧の取得")])]),a("li",[a("a",{attrs:{href:"#webelementのソース取得"}},[t._v("WebElementのソース取得")])]),a("li",[a("a",{attrs:{href:"#mp3のダウンロード先のurl"}},[t._v("mp3のダウンロード先のURL")])]),a("li",[a("a",{attrs:{href:"#mp3のダウンロード"}},[t._v("mp3のダウンロード")])])])]),a("li",[a("a",{attrs:{href:"#まとめ"}},[t._v("まとめ")])]),a("li",[a("a",{attrs:{href:"#参考サイト"}},[t._v("参考サイト")])])])]),a("p"),t._v(" "),a("p",[a("a",{attrs:{href:"//af.moshimo.com/af/c/click?a_id=2604050&p_id=1555&pc_id=2816&pl_id=29835&guid=ON",rel:"nofollow",referrerpolicy:"no-referrer-when-downgrade"}},[a("img",{staticStyle:{border:"none"},attrs:{src:"//image.moshimo.com/af-img/0866/000000029835.jpg",width:"728",height:"90"}})]),a("img",{staticStyle:{border:"none"},attrs:{src:"//i.moshimo.com/af/i/impression?a_id=2604050&p_id=1555&pc_id=2816&pl_id=29835",width:"1",height:"1"}})]),t._v(" "),a("p",[a("a",{attrs:{href:"//af.moshimo.com/af/c/click?a_id=2641145&p_id=1770&pc_id=3386&pl_id=25847&guid=ON",rel:"nofollow",referrerpolicy:"no-referrer-when-downgrade"}},[a("img",{staticStyle:{border:"none"},attrs:{src:"//image.moshimo.com/af-img/1115/000000025847.png",width:"728",height:"90"}})]),a("img",{staticStyle:{border:"none"},attrs:{src:"//i.moshimo.com/af/i/impression?a_id=2641145&p_id=1770&pc_id=3386&pl_id=25847",width:"1",height:"1"}})]),t._v(" "),a("h2",{attrs:{id:"seleniumの操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#seleniumの操作"}},[t._v("#")]),t._v(" Seleniumの操作")]),t._v(" "),a("h3",{attrs:{id:"モジュール"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#モジュール"}},[t._v("#")]),t._v(" モジュール")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# coding: UTF-8")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" requests\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" urllib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" selenium "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" webdriver\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" selenium"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("webdriver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("chrome"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Options\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" selene"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("driver "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" SeleneDriver\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" webdriver_manager"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("utils "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" chrome_version\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" webdriver_manager"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("chrome "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" ChromeDriverManager\n")])])]),a("h3",{attrs:{id:"ページソースの表示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ページソースの表示"}},[t._v("#")]),t._v(" ページソースの表示")]),t._v(" "),a("p",[t._v("seleniumでイメージ音楽のページソースを取得します．")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ページソースの表示")]),t._v("\ndriver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("page_source\n")])])]),a("h3",{attrs:{id:"ページ一覧の取得"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ページ一覧の取得"}},[t._v("#")]),t._v(" ページ一覧の取得")]),t._v(" "),a("p",[t._v("イメージ音楽のページから，2ページ目,3ページ目のURLを取得します．"),a("br"),t._v("\n2ページ目,3ページ目のURLを示すclass名のpagerは1箇所しかないので,find_element_by_class_nameを使います．単数形のelementですので注意してください．")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# classで指定(1つ：find_element_by_class_name)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ※ find_element!!")]),t._v("\nelement "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" driver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("find_element_by_class_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pager"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2ページ目,3ページ目のURLを示すtagを取得")]),t._v("\naPageTags "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" element"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("find_elements_by_tag_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"a"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# tagから2ページ目,3ページ目のURLを取得")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" aPageTag "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" aPageTags"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# tagからhref要素を取得")]),t._v("\n    page_url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" aPageTag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_attribute"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'href'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("page_url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h3",{attrs:{id:"webelementのソース取得"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webelementのソース取得"}},[t._v("#")]),t._v(" WebElementのソース取得")]),t._v(" "),a("p",[t._v("find_element_by_class_name()で取得したWebElementのソースを確認します．")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("element"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_attribute"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'innerHTML'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# WebElementからhtmlを取得")]),t._v("\n")])])]),a("h3",{attrs:{id:"mp3のダウンロード先のurl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mp3のダウンロード先のurl"}},[t._v("#")]),t._v(" mp3のダウンロード先のURL")]),t._v(" "),a("p",[t._v("イメージ音楽のページから，各mp3のダウンロード先のURLを取得します．"),a("br"),t._v("\nイメージとしては，右クリックで「リンク先をダウンロード」する際の参照先となるURLを探す作業です．"),a("br"),t._v("\nmp3のURLを示すclass名のdownloadは複数箇所あるので,find_elements_by_class_nameを使います．複数形のelementsですので注意してください．．"),a("br"),t._v("\n取得した各mp3の詳細ページのURLを元にダウンロード先のURLに設定されていたので，ダウンロード先のURLはreplace()で置換して取得しました．")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# classで指定(複数：find_elements_by_class_name)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ※ find_elements!!")]),t._v("\nelements "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" driver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("find_elements_by_class_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"download"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" element "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" elements"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#print(element.get_attribute('innerHTML')) # WebElementからhtmlを取得")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mp3の詳細ページのURL,tagで取得")]),t._v("\n    aTag "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" element"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("find_element_by_tag_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"a"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mp3のダウンロードページのURL")]),t._v("\n    dlurl "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" aTag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_attribute"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'href'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("replace"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'music_'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mp3/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("replace"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.html'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.mp3'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h3",{attrs:{id:"mp3のダウンロード"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mp3のダウンロード"}},[t._v("#")]),t._v(" mp3のダウンロード")]),t._v(" "),a("p",[t._v("取得したmp3のURLからmp3ファイルをダウンロードします．イメージとしては，リンク先をダウンロードの作業です．")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("dlfile "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bgm/'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" dlurl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("split"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 保存ファイル名")]),t._v("\nurllib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("urlretrieve"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dlurl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dlfile"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#ダウンロード実行:要はリンク先をダウンロード")]),t._v("\n")])])]),a("h2",{attrs:{id:"まとめ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#まとめ"}},[t._v("#")]),t._v(" まとめ")]),t._v(" "),a("p",[t._v("ここまででおおよそのseleniumの操作を検索しながら，必要な工程を実装しました．次の記事でdef文でまとめようと思います．")]),t._v(" "),a("h2",{attrs:{id:"参考サイト"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考サイト"}},[t._v("#")]),t._v(" 参考サイト")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://qiita.com/Chanmoro/items/9a3c86bb465c1cce738a",target:"_blank",rel:"noopener noreferrer"}},[t._v("10分で理解する Selenium"),a("OutboundLink")],1),a("br"),t._v(" "),a("a",{attrs:{href:"https://qiita.com/kei0919/items/f6f696169c92c936374c",target:"_blank",rel:"noopener noreferrer"}},[t._v("Dockerコンテナからseleniumを使ってスクレイピング"),a("OutboundLink")],1),a("br"),t._v(" "),a("a",{attrs:{href:"https://qiita.com/maroKanatani/items/e52984f37cc5474ccd98",target:"_blank",rel:"noopener noreferrer"}},[t._v("Python×SeleniumでWebスクレイピング実践"),a("OutboundLink")],1),a("br"),t._v(" "),a("a",{attrs:{href:"https://qiita.com/mochio/items/dc9935ee607895420186",target:"_blank",rel:"noopener noreferrer"}},[t._v("Selenium webdriverよく使う操作メソッドまとめ"),a("OutboundLink")],1),a("br"),t._v(" "),a("a",{attrs:{href:"https://qiita.com/sikkim/items/447b72e6ec45849058cd",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker上でSeleniumとHeadless ChromeとPython3を動かす"),a("OutboundLink")],1),a("br"),t._v(" "),a("a",{attrs:{href:"https://engineeeer.com/python-selenium-webelement-get-html/",target:"_blank",rel:"noopener noreferrer"}},[t._v("【Python】seleniumでWebElementからhtmlを取得する"),a("OutboundLink")],1),a("br"),t._v(" "),a("a",{attrs:{href:"https://qiita.com/memakura/items/f80d2e2c59514cfc14c9",target:"_blank",rel:"noopener noreferrer"}},[t._v("Python + Selenium + Chrome でファイル保存まわり"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"//af.moshimo.com/af/c/click?a_id=2604050&p_id=1555&pc_id=2816&pl_id=29835&guid=ON",rel:"nofollow",referrerpolicy:"no-referrer-when-downgrade"}},[a("img",{staticStyle:{border:"none"},attrs:{src:"//image.moshimo.com/af-img/0866/000000029835.jpg",width:"728",height:"90"}})]),a("img",{staticStyle:{border:"none"},attrs:{src:"//i.moshimo.com/af/i/impression?a_id=2604050&p_id=1555&pc_id=2816&pl_id=29835",width:"1",height:"1"}})]),t._v(" "),a("p",[a("a",{attrs:{href:"//af.moshimo.com/af/c/click?a_id=2641145&p_id=1770&pc_id=3386&pl_id=25847&guid=ON",rel:"nofollow",referrerpolicy:"no-referrer-when-downgrade"}},[a("img",{staticStyle:{border:"none"},attrs:{src:"//image.moshimo.com/af-img/1115/000000025847.png",width:"728",height:"90"}})]),a("img",{staticStyle:{border:"none"},attrs:{src:"//i.moshimo.com/af/i/impression?a_id=2641145&p_id=1770&pc_id=3386&pl_id=25847",width:"1",height:"1"}})]),t._v(" "),a("ClientOnly",[a("CallInArticleAdsense")],1)],1)}),[],!1,null,null,null);e.default=n.exports}}]);